import{F as i}from"./ui-BcXBiFQq.js";const f=r=>{let o;const e=new Set,s=(a,u)=>{const n=typeof a=="function"?a(o):a;if(!Object.is(n,o)){const g=o;o=u??(typeof n!="object"||n===null)?n:Object.assign({},o,n),e.forEach(E=>E(o,g))}},t=()=>o,l={setState:s,getState:t,getInitialState:()=>v,subscribe:a=>(e.add(a),()=>e.delete(a))},v=o=r(s,t,l);return l},p=(r=>r?f(r):f),S=r=>r;function y(r,o=S){const e=i.useSyncExternalStore(r.subscribe,i.useCallback(()=>o(r.getState()),[r,o]),i.useCallback(()=>o(r.getInitialState()),[r,o]));return i.useDebugValue(e),e}const d=r=>{const o=p(r),e=s=>y(o,s);return Object.assign(e,o),e},b=(r=>r?d(r):d),w=b((r,o)=>({favorites:[],loading:!1,error:null,addToFavorites:async e=>{const s=o();if(!s.favorites.some(t=>t.id===e.id)){r({loading:!0,error:null});try{if(!(await fetch("/api/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1,announcement_id:e.id})})).ok)throw new Error("Erreur lors de l'ajout aux favoris");r({favorites:[...s.favorites,e],loading:!1})}catch(t){console.error("Erreur addToFavorites:",t),r({loading:!1,error:t instanceof Error?t.message:"Erreur inconnue"})}}},removeFromFavorites:async e=>{const s=o();r({loading:!0,error:null});try{if(!(await fetch(`/api/favorites/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1})})).ok)throw new Error("Erreur lors de la suppression des favoris");r({favorites:s.favorites.filter(c=>c.id!==e),loading:!1})}catch(t){console.error("Erreur removeFromFavorites:",t),r({loading:!1,error:t instanceof Error?t.message:"Erreur inconnue"})}},loadFavorites:async()=>{r({loading:!0,error:null});try{const e=await fetch("/api/favorites?user_id=1");if(!e.ok)throw new Error("Erreur lors du chargement des favoris");const s=await e.json();r({favorites:s.favorites||[],loading:!1})}catch(e){console.error("Erreur loadFavorites:",e),r({loading:!1,error:e instanceof Error?e.message:"Erreur inconnue",favorites:[]})}},isFavorite:e=>o().favorites.some(s=>s.id===e)}));export{b as c,w as u};
