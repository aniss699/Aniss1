import{r as f,j as e}from"./ui-BcXBiFQq.js";import{u as ge}from"./useQuery-CMqpr-vk.js";import{j as se,e as U,k as ke,l as Ce,v as Se,L as g,I as q,B as p,g as te,f as le,U as M,m as W,P as ie,C as R,a as F,i as P,n as J,X as Y,b as T,o as ne,Z as qe,D as $,q as I,r as de,s as ce,V as _e,h as Me,d as Re,t as Te,T as ue}from"./index-DBWpbIA-.js";import{d as De}from"./services-DKmuAkBs.js";import{f as Q,g as ze,a as he}from"./categories-KhEpuZy7.js";import{T as je,a as be,b as A,c as B}from"./tabs-Cfru0-yA.js";import{T as V}from"./textarea-BFXzcP4Q.js";import{S as H,a as G,b as X,c as Z,d as C}from"./select-C9-gtWmM.js";import{B as w}from"./badge-Bmhfmc9_.js";import{S as ae}from"./star-VlDWI1Kx.js";import{E as ee}from"./euro-ClvpjDrH.js";import{C as L}from"./calendar-CT-mYYTu.js";import{S as Fe}from"./switch-joWYUrNc.js";import{S as Pe}from"./settings-BUMApRKs.js";import{G as Ae}from"./globe-nuVoynEv.js";import{L as Be}from"./lock-BlwFZdLW.js";import{S as Ee}from"./smart-bid-analyzer-CmbiGeTM.js";import{A as ve}from"./award-DSxzil4s.js";import{M as O}from"./message-circle-DSGQ189v.js";import{A as $e}from"./availability-calendar-C4ZJ7dbD.js";import{M as fe}from"./map-pin-B4QDdXS3.js";import{P as Ie}from"./phone-DSnczjCY.js";import{C as Ne}from"./clock-BLN4Qwei.js";import{C as Ve}from"./circle-x-BHO_Cr_F.js";import{C as Le}from"./circle-alert-CoTUbvGH.js";import{C as Oe}from"./chevron-left-CIS61OmY.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=se("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=se("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=se("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=se("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function Ke({missionId:x,onSuccess:j}){const{user:m}=U(),[n,N]=f.useState({amount:"",timeline:"",proposal:""}),d=ke("/api/bids",{successMessage:"🚀 Offre envoyée avec succès !",errorContext:"Soumission d'offre",invalidateQueries:[["/api/missions",x],["/api/missions"],["/api/users",m?.id,"bids"]],onSuccess:()=>{N({amount:"",timeline:"",proposal:""}),j()}}),b=Ce({onSubmit:async r=>{d.mutate(r)},validateBeforeSubmit:Se.validateBid}),t=r=>{if(r.preventDefault(),!m){b.handleError(new Error("Vous devez être connecté pour postuler"),"Authentification requise");return}b.handleSubmit({...n,missionId:x,providerId:m.id,providerName:m.name,amount:n.amount,rating:m.rating||"5.0"})},i=(r,u)=>{N(y=>({...y,[r]:u}))};return!m||m.type!=="provider"?null:e.jsx("div",{className:"bg-white rounded-lg p-1",children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"amount",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"💰"}),e.jsx("span",{children:"Prix proposé (€)"})]}),e.jsx(q,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Ex: 2500",value:n.amount,onChange:r=>i("amount",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-colors",required:!0,"data-testid":"input-bid-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"timeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"⏱️"}),e.jsx("span",{children:"Délai de livraison"})]}),e.jsx(q,{id:"timeline",type:"text",placeholder:"Ex: 4 semaines",value:n.timeline,onChange:r=>i("timeline",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-colors",required:!0,"data-testid":"input-bid-timeline"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"proposal",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"📝"}),e.jsx("span",{children:"Décrivez votre proposition"})]}),e.jsx(V,{id:"proposal",placeholder:"Expliquez votre approche, votre expérience pertinente et ce que vous allez concrètement livrer pour cette mission...",value:n.proposal,onChange:r=>i("proposal",r.target.value),className:"min-h-[120px] rounded-lg border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-100 resize-none transition-colors",required:!0,"data-testid":"textarea-bid-proposal"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(p,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-lg text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]",disabled:d.isPending||b.isSubmitting,"data-testid":"button-submit-bid",children:d.isPending||b.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚀"}),e.jsx("span",{children:"Envoyer ma candidature"})]})})})]})})}function Qe({missionId:x,onSuccess:j}){const{user:m}=U(),{toast:n}=te(),N=le(),[d,b]=f.useState(!1),[t,i]=f.useState({amount:"",timeline_days:"",message:""}),[r,u]=f.useState([{name:m?.name||"",role:"Chef d'équipe",experience:"5+ années",isLead:!0,rating:4.5}]),y=()=>{const l={name:"",role:"",experience:"",isLead:!1,rating:4};u([...r,l])},k=(l,h,a)=>{const s=[...r];s[l]={...s[l],[h]:a},u(s)},S=l=>{if(l===0)return;const h=r.filter((a,s)=>s!==l);u(h)},_=async l=>{if(l.preventDefault(),!m){n({title:"Erreur",description:"Vous devez être connecté pour soumettre une offre",variant:"destructive"});return}if(!t.amount||!t.timeline_days||!t.message){n({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}if(r.length<2){n({title:"Erreur",description:"Une équipe doit avoir au moins 2 membres",variant:"destructive"});return}if(r.filter(a=>!a.name||!a.role||!a.experience).length>0){n({title:"Erreur",description:"Veuillez compléter les informations de tous les membres de l'équipe",variant:"destructive"});return}b(!0);try{const a={members:r,total_budget:parseInt(t.amount),estimated_timeline:parseInt(t.timeline_days),description:t.message},c=await(await ne("POST","/api/bids",{mission_id:parseInt(x),amount:t.amount,timeline_days:parseInt(t.timeline_days),message:t.message,bid_type:"team",team_composition:a,team_lead_id:m.id})).json();n({title:"✅ Candidature d'équipe soumise !",description:`Votre équipe de ${r.length} membres a été proposée avec succès.`}),N.invalidateQueries({queryKey:["mission-detail",x]}),N.invalidateQueries({queryKey:["missions"]}),j()}catch(a){console.error("Erreur soumission candidature équipe:",a),n({title:"Erreur",description:a instanceof Error?a.message:"Impossible de soumettre la candidature",variant:"destructive"})}finally{b(!1)}};return!m||m.type!=="provider"?null:e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Candidature d'équipe"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Présentez votre équipe pré-constituée pour cette mission"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Composition de l'équipe"]}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:y,"data-testid":"button-add-member",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((l,h)=>e.jsxs(R,{className:`${l.isLead?"ring-2 ring-purple-200 bg-purple-50":"bg-gray-50"}`,children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-sm flex items-center gap-2",children:l.isLead?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 text-purple-600"}),"Chef d'équipe"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4"}),"Membre ",h]})}),!l.isLead&&e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(h),"data-testid":`button-remove-member-${h}`,children:e.jsx(Y,{className:"w-4 h-4"})})]})}),e.jsxs(T,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Nom complet *"}),e.jsx(q,{placeholder:"Nom du membre",value:l.name,onChange:a=>k(h,"name",a.target.value),disabled:l.isLead,"data-testid":`input-member-name-${h}`})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Rôle/Spécialité *"}),e.jsx(q,{placeholder:"Ex: Développeur Frontend",value:l.role,onChange:a=>k(h,"role",a.target.value),"data-testid":`input-member-role-${h}`})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Expérience *"}),e.jsxs(H,{value:l.experience,onValueChange:a=>k(h,"experience",a),children:[e.jsx(G,{"data-testid":`select-member-experience-${h}`,children:e.jsx(X,{placeholder:"Niveau d'expérience"})}),e.jsxs(Z,{children:[e.jsx(C,{value:"1-2 années",children:"1-2 années"}),e.jsx(C,{value:"3-5 années",children:"3-5 années"}),e.jsx(C,{value:"5+ années",children:"5+ années"}),e.jsx(C,{value:"10+ années",children:"10+ années"})]})]})]})]})]},h))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"team-amount",className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Prix total équipe (€) *"]}),e.jsx(q,{id:"team-amount",type:"number",placeholder:"15000",min:"100",value:t.amount,onChange:l=>i(h=>({...h,amount:l.target.value})),"data-testid":"input-team-amount"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Montant global pour toute l'équipe"})]}),e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"team-timeline",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Délai (jours) *"]}),e.jsx(q,{id:"team-timeline",type:"number",placeholder:"30",min:"1",value:t.timeline_days,onChange:l=>i(h=>({...h,timeline_days:l.target.value})),"data-testid":"input-team-timeline"})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"team-message",className:"text-base font-medium",children:"Proposition détaillée *"}),e.jsx(V,{id:"team-message",placeholder:"Décrivez comment votre équipe va réaliser cette mission, la répartition des tâches, votre méthodologie...",rows:5,value:t.message,onChange:l=>i(h=>({...h,message:l.target.value})),"data-testid":"textarea-team-message"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Détaillez la stratégie de votre équipe pour cette mission"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Récapitulatif de l'équipe"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres:"}),e.jsxs(w,{variant:"secondary",children:[r.length," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget total:"}),e.jsxs(w,{variant:"secondary",children:[t.amount||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Délai:"}),e.jsxs(w,{variant:"secondary",children:[t.timeline_days||"0"," jours"]})]})]})]}),e.jsx(p,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:d,"data-testid":"button-submit-team-bid",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Soumission en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Soumettre la candidature d'équipe"]})})]})}function He({missionId:x,onSuccess:j}){const{user:m}=U(),{toast:n}=te(),N=le(),[d,b]=f.useState(!1),[t,i]=f.useState({name:"",description:"",estimated_budget:"",estimated_timeline_days:"",max_members:"5",visibility:"public",auto_accept:!0}),[r,u]=f.useState([{title:"",description:"",skills:[],min_experience:1,priority:"medium"}]),y=()=>{const a={title:"",description:"",skills:[],min_experience:1,priority:"medium"};u([...r,a])},k=(a,s,c)=>{const v=[...r];v[a]={...v[a],[s]:c},u(v)},S=a=>{if(r.length<=1)return;const s=r.filter((c,v)=>v!==a);u(s)},_=(a,s)=>{if(!s.trim())return;const c=[...r],v=c[a].skills;v.includes(s.trim())||(c[a].skills=[...v,s.trim()],u(c))},l=(a,s)=>{const c=[...r];c[a].skills=c[a].skills.filter((v,re)=>re!==s),u(c)},h=async a=>{if(a.preventDefault(),!m){n({title:"Erreur",description:"Vous devez être connecté pour créer une équipe ouverte",variant:"destructive"});return}if(!t.name||!t.description||!t.estimated_budget||!t.estimated_timeline_days){n({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}const s=r.filter(c=>c.title.trim());if(s.length===0){n({title:"Erreur",description:"Veuillez définir au moins un rôle recherché",variant:"destructive"});return}b(!0);try{const v=await(await ne("POST","/api/open-teams",{mission_id:parseInt(x),name:t.name,description:t.description,estimated_budget:parseInt(t.estimated_budget)*100,estimated_timeline_days:parseInt(t.estimated_timeline_days),max_members:parseInt(t.max_members),visibility:t.visibility,auto_accept:t.auto_accept,required_roles:s,members:[{user_id:m.id,name:m.name,role:"Initiateur",experience_years:5,rating:4.5,joined_at:new Date().toISOString()}]})).json();n({title:"🚀 Équipe ouverte créée !",description:`${t.name} est maintenant ouverte au recrutement.`}),N.invalidateQueries({queryKey:["mission-detail",x]}),N.invalidateQueries({queryKey:["open-teams"]}),j()}catch(c){console.error("Erreur création équipe ouverte:",c),n({title:"Erreur",description:c instanceof Error?c.message:"Impossible de créer l'équipe ouverte",variant:"destructive"})}finally{b(!1)}};return!m||m.type!=="provider"?null:e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Créer une équipe ouverte"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Initiez une équipe où d'autres prestataires peuvent vous rejoindre"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"team-name",className:"text-base font-medium",children:"Nom de l'équipe *"}),e.jsx(q,{id:"team-name",placeholder:"Ex: Équipe Développement Web Pro",value:t.name,onChange:a=>i(s=>({...s,name:a.target.value})),"data-testid":"input-team-name"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"team-description",className:"text-base font-medium",children:"Description de l'équipe *"}),e.jsx(V,{id:"team-description",placeholder:"Décrivez votre approche, votre vision pour cette mission...",rows:3,value:t.description,onChange:a=>i(s=>({...s,description:a.target.value})),"data-testid":"textarea-team-description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"estimated-budget",className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Budget estimé (€) *"]}),e.jsx(q,{id:"estimated-budget",type:"number",placeholder:"10000",min:"100",value:t.estimated_budget,onChange:a=>i(s=>({...s,estimated_budget:a.target.value})),"data-testid":"input-estimated-budget"})]}),e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"estimated-timeline",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Délai estimé (jours) *"]}),e.jsx(q,{id:"estimated-timeline",type:"number",placeholder:"45",min:"1",value:t.estimated_timeline_days,onChange:a=>i(s=>({...s,estimated_timeline_days:a.target.value})),"data-testid":"input-estimated-timeline"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Rôles recherchés"]}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:y,"data-testid":"button-add-role",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((a,s)=>e.jsxs(R,{className:"bg-orange-50 border-orange-200",children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(P,{className:"text-sm",children:["Rôle ",s+1]}),r.length>1&&e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(s),"data-testid":`button-remove-role-${s}`,children:e.jsx(Y,{className:"w-4 h-4"})})]})}),e.jsxs(T,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Titre du poste *"}),e.jsx(q,{placeholder:"Ex: Développeur React",value:a.title,onChange:c=>k(s,"title",c.target.value),"data-testid":`input-role-title-${s}`})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Priorité"}),e.jsxs(H,{value:a.priority,onValueChange:c=>k(s,"priority",c),children:[e.jsx(G,{"data-testid":`select-role-priority-${s}`,children:e.jsx(X,{})}),e.jsxs(Z,{children:[e.jsx(C,{value:"high",children:"Haute"}),e.jsx(C,{value:"medium",children:"Moyenne"}),e.jsx(C,{value:"low",children:"Basse"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Description du rôle"}),e.jsx(V,{placeholder:"Décrivez les responsabilités et attentes...",rows:2,value:a.description,onChange:c=>k(s,"description",c.target.value),"data-testid":`textarea-role-description-${s}`})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Compétences requises"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.skills.map((c,v)=>e.jsxs(w,{variant:"secondary",className:"flex items-center gap-1",children:[c,e.jsx(Y,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>l(s,v)})]},v))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{placeholder:"Ajouter une compétence...",onKeyPress:c=>{c.key==="Enter"&&(c.preventDefault(),_(s,c.currentTarget.value),c.currentTarget.value="")},"data-testid":`input-role-skill-${s}`}),e.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:c=>{const v=c.currentTarget.parentNode?.querySelector("input");v&&(_(s,v.value),v.value="")},children:e.jsx(ie,{className:"w-4 h-4"})})]})]})]})]},s))})]}),e.jsxs(R,{className:"bg-gray-50",children:[e.jsx(F,{children:e.jsxs(P,{className:"text-sm flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Paramètres de l'équipe"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Nombre max de membres"}),e.jsxs(H,{value:t.max_members,onValueChange:a=>i(s=>({...s,max_members:a})),children:[e.jsx(G,{"data-testid":"select-max-members",children:e.jsx(X,{})}),e.jsxs(Z,{children:[e.jsx(C,{value:"3",children:"3 membres"}),e.jsx(C,{value:"5",children:"5 membres"}),e.jsx(C,{value:"7",children:"7 membres"}),e.jsx(C,{value:"10",children:"10 membres"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Visibilité"}),e.jsxs(H,{value:t.visibility,onValueChange:a=>i(s=>({...s,visibility:a})),children:[e.jsx(G,{"data-testid":"select-visibility",children:e.jsx(X,{})}),e.jsxs(Z,{children:[e.jsx(C,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Publique"]})}),e.jsx(C,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Privée"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{id:"auto-accept",checked:t.auto_accept,onCheckedChange:a=>i(s=>({...s,auto_accept:a})),"data-testid":"switch-auto-accept"}),e.jsx(g,{htmlFor:"auto-accept",className:"text-sm",children:"Accepter automatiquement les candidatures"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Récapitulatif de l'équipe ouverte"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Nom:"}),e.jsx(w,{variant:"secondary",children:t.name||"Non défini"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget estimé:"}),e.jsxs(w,{variant:"secondary",children:[t.estimated_budget||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres max:"}),e.jsxs(w,{variant:"secondary",children:[t.max_members," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Rôles définis:"}),e.jsxs(w,{variant:"secondary",children:[r.filter(a=>a.title).length," rôles"]})]})]})]}),e.jsx(p,{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-700",disabled:d,"data-testid":"button-submit-open-team",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Création en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Créer l'équipe ouverte"]})})]})}function Ge({mission:x,user:j,sortedBids:m,showAIAnalyzer:n,setShowAIAnalyzer:N,showBidForm:d,setShowBidForm:b}){const[t,i]=f.useState("individual"),[r,u]=f.useState(!1),[y,k]=f.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 md:p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:"Candidater à cette mission"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Choisissez votre mode de candidature"})]})]}),e.jsxs(je,{value:t,onValueChange:S=>i(S),className:"w-full",children:[e.jsxs(be,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(A,{value:"individual",className:"text-xs md:text-sm data-[testid=tab-individual]","data-testid":"tab-individual",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Solo"]}),e.jsxs(A,{value:"team",className:"text-xs md:text-sm","data-testid":"tab-team",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Équipe"]}),e.jsxs(A,{value:"open_team",className:"text-xs md:text-sm","data-testid":"tab-open-team",children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Équipe Ouverte"]})]}),e.jsx(B,{value:"individual",className:"space-y-4 mt-0",children:e.jsxs(R,{className:"bg-blue-50 border-blue-200",children:[e.jsx(F,{className:"pb-3",children:e.jsxs(P,{className:"text-sm flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Candidature individuelle"]})}),e.jsxs(T,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez seul à cette mission avec votre expertise."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(p,{onClick:()=>N(!n),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-sm",size:"default","data-testid":"button-ai-analyzer",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Analyser avec l'IA"]}),e.jsxs(p,{onClick:()=>b(!d),className:"w-full bg-green-600 hover:bg-green-700 text-sm",size:"default","data-testid":"button-submit-individual",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),d?"Masquer le formulaire":"Soumettre une offre"]})]}),n&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ee,{missionTitle:x.title,missionDescription:x.description,missionBudget:parseFloat(x.budget||"0"),missionCategory:x.category,currentBid:{price:0,timeline:"",proposal:""},providerProfile:{rating:4.5,completedProjects:25,skills:["React","Node.js","TypeScript"],portfolio:[]},competitorBids:m,onOptimizedBidGenerated:S=>{b(!0)}})}),d&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ke,{missionId:x.id,onSuccess:()=>{b(!1),N(!1)}})})]})]})}),e.jsx(B,{value:"team",className:"space-y-4 mt-0",children:e.jsxs(R,{className:"bg-purple-50 border-purple-200",children:[e.jsx(F,{className:"pb-3",children:e.jsxs(P,{className:"text-sm flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Candidature d'équipe"]})}),e.jsxs(T,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez avec une équipe pré-constituée que vous dirigez."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg border",children:[e.jsx(ae,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vous êtes le chef d'équipe"})]}),e.jsxs(p,{onClick:()=>u(!r),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",size:"default","data-testid":"button-submit-team",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),r?"Masquer le formulaire":"Candidater en équipe"]})]}),r&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Qe,{missionId:x.id,onSuccess:()=>{u(!1)}})})]})]})}),e.jsx(B,{value:"open_team",className:"space-y-4 mt-0",children:e.jsxs(R,{className:"bg-orange-50 border-orange-200",children:[e.jsx(F,{className:"pb-3",children:e.jsxs(P,{className:"text-sm flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Équipe ouverte"]})}),e.jsxs(T,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Créez une équipe ouverte où d'autres prestataires peuvent vous rejoindre."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(ye,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Recrutement ouvert"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Ue,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Collaboration"})]})]}),e.jsxs(p,{onClick:()=>k(!y),className:"w-full bg-orange-600 hover:bg-orange-700 text-sm",size:"default","data-testid":"button-submit-open-team",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),y?"Masquer le formulaire":"Créer une équipe ouverte"]})]}),y&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(He,{missionId:x.id,onSuccess:()=>{k(!1)}})})]})]})})]})]})}function Xe({providerId:x,providerName:j,isOpen:m,onClose:n}){const{toast:N}=te(),{data:d,isLoading:b}=ge({queryKey:["/api/providers",x,"profile"],enabled:!!x&&m}),t=i=>Array.from({length:5},(r,u)=>e.jsx(ae,{className:`w-4 h-4 ${u<i?"text-yellow-400 fill-current":"text-gray-300"}`},u));return!m||!x?null:e.jsx($,{open:m,onOpenChange:n,children:e.jsxs(I,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsx(ce,{asChild:!0,children:e.jsx(_e,{children:"Profil du prestataire"})})}),e.jsx("div",{className:"p-6"}),b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):d?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:d.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),d.location||"Localisation non spécifiée"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Membre depuis ",Q(d.joinedAt)]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:d.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end mb-2",children:[e.jsx("div",{className:"flex items-center mr-2",children:t(Math.round(parseFloat(d.rating)))}),e.jsx("span",{className:"text-xl font-bold",children:d.rating})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[d.totalProjects," projets réalisés"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.skills.map((i,r)=>e.jsx(w,{variant:"secondary",children:i},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs(p,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{window.location.href=`/messages?contact=${x}&name=${encodeURIComponent(j)}`},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(p,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",onClick:()=>{N({title:"Contacter le prestataire",description:`Appelez ${j} pour discuter du projet`})},children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Appeler"]}),e.jsxs(p,{className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white",onClick:()=>{N({title:"Réservation de créneau",description:`Fonctionnalité de réservation avec ${j} en cours de développement`})},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Réserver un créneau"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),"Réalisations récentes"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:d.portfolio.slice(0,4).map(i=>e.jsx(R,{children:e.jsxs(T,{className:"p-4",children:[i.images.length>0&&e.jsx("img",{src:i.images[0],alt:i.title,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:i.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(w,{variant:"outline",children:i.category}),e.jsx("span",{className:"text-xs text-gray-500",children:Q(i.completedAt)})]})]})},i.id))}),d.portfolio.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune réalisation disponible pour le moment"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Disponibilités"]}),e.jsx(R,{children:e.jsx(T,{className:"p-4",children:e.jsx($e,{readOnly:!0,initialAvailability:d.availability||[]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ve,{className:"w-5 h-5 mr-2"}),"Avis clients (",d.evaluations.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:d.evaluations.map(i=>e.jsx(R,{children:e.jsxs(T,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[t(i.rating),e.jsx("span",{className:"ml-2 font-medium",children:i.clientName})]}),e.jsx("span",{className:"text-xs text-gray-500",children:Q(i.createdAt)})]})}),e.jsx("p",{className:"text-gray-700 mb-3",children:i.comment}),i.photos&&i.photos.length>0&&e.jsx("div",{className:"flex space-x-2",children:i.photos.slice(0,3).map((r,u)=>e.jsx("img",{src:r,alt:`Photo ${u+1}`,className:"w-16 h-16 object-cover rounded-lg"},u))})]})},i.id))}),d.evaluations.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun avis client pour le moment"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{onClick:n,children:"Fermer"})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Profil non trouvé"})})]})})}function Ze({bidId:x,bidderName:j,isOpen:m,onClose:n}){const{user:N}=U(),{toast:d}=te(),b=le(),[t,i]=f.useState(null),[r,u]=f.useState(""),y=Me({mutationFn:async l=>(await ne("POST","/api/bids/respond",l)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/missions"]});const l=t==="accept"?"acceptée":t==="reject"?"déclinée":"en négociation";d({title:"Réponse envoyée !",description:`Votre réponse (${l}) a été envoyée au prestataire. Il recevra une notification.`}),setTimeout(()=>{alert(`Confirmation : Votre réponse "${l}" a bien été envoyée à ${j}. Un email de confirmation lui a été envoyé.`)},500),n(),i(null),u("")},onError:l=>{d({title:"Erreur",description:l.message||"Une erreur est survenue",variant:"destructive"})}}),k=l=>{if(l.preventDefault(),!t){d({title:"Action requise",description:"Veuillez choisir une action",variant:"destructive"});return}if(t==="negotiate"&&!r.trim()){d({title:"Message requis",description:"Veuillez ajouter un message pour négocier",variant:"destructive"});return}y.mutate({bidId:x,status:t,message:r.trim()||null,clientResponse:t})},S=l=>{switch(l){case"accept":return`Bonjour ${j},

Nous avons le plaisir de vous informer que votre offre a été retenue pour ce projet. Nous allons procéder à la mise en place du contrat.

Cordialement`;case"reject":return`Bonjour ${j},

Nous vous remercions pour votre offre. Malheureusement, nous avons décidé de retenir une autre proposition pour ce projet.

Cordialement`;case"negotiate":return`Bonjour ${j},

Votre offre nous intéresse. Cependant, nous aimerions discuter de certains points :

- 
- 

Êtes-vous ouvert à la négociation ?

Cordialement`}},_=l=>{i(l),u(S(l))};return e.jsx($,{open:m,onOpenChange:n,children:e.jsxs(I,{className:"sm:max-w-2xl bg-white border shadow-lg",children:[e.jsx(de,{children:e.jsxs(ce,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6 text-blue-500"}),"Répondre à l'offre de ",j]})}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choisissez votre réponse :"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>_("accept"),className:`p-4 rounded-xl border-2 transition-all ${t==="accept"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(Re,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"font-semibold",children:"Accepter"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Retenir cette offre"})]}),e.jsxs("button",{type:"button",onClick:()=>_("negotiate"),className:`p-4 rounded-xl border-2 transition-all ${t==="negotiate"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"font-semibold",children:"Négocier"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Demander des ajustements"})]}),e.jsxs("button",{type:"button",onClick:()=>_("reject"),className:`p-4 rounded-xl border-2 transition-all ${t==="reject"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-red-300"}`,children:[e.jsx(Ve,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"font-semibold",children:"Décliner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ne pas retenir"})]})]})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"message",className:"text-sm font-semibold text-gray-800",children:["Message à ",j]}),e.jsx(V,{id:"message",value:r,onChange:l=>u(l.target.value),placeholder:"Votre message...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:n,className:"flex-1",disabled:y.isPending,children:"Annuler"}),e.jsx(p,{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600",disabled:!t||y.isPending,children:y.isPending?"Envoi...":"Envoyer la réponse"})]})]})]})})}function ws({missionId:x,isOpen:j,onClose:m}){const{user:n}=U(),[N,d]=f.useState("overview"),[b,t]=f.useState(null),[i,r]=f.useState(""),[u,y]=f.useState(null),[k,S]=f.useState(""),[_,l]=f.useState(!1),[h,a]=f.useState(!1),{data:s,isLoading:c,error:v}=ge({queryKey:["mission-detail",x],queryFn:async()=>{if(!x)throw new Error("ID de mission manquant");console.log("🔍 Chargement mission avec mappers ID:",x);const o=await De.getMissionById(x);return console.log("✅ Mission normalisée chargée:",o.title),o},enabled:!!x&&j,retry:1,retryDelay:2e3,staleTime:3e4}),re=o=>{const z=typeof o=="string"?parseFloat(o):o;return Array.from({length:5},(xe,K)=>e.jsx(ae,{className:`w-4 h-4 ${K<Math.floor(z)?"text-yellow-400 fill-current":"text-gray-300 dark:text-gray-600"}`},K))};if(c)return e.jsx($,{open:j,onOpenChange:m,children:e.jsx(I,{className:"w-[95vw] max-w-4xl mx-auto p-8 bg-white dark:bg-gray-900 border-0 shadow-xl rounded-2xl",children:e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Chargement de la mission"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Récupération des détails..."})]})]})})})});if(v||!s)return e.jsx($,{open:j,onOpenChange:m,children:e.jsx(I,{className:"w-[95vw] max-w-lg mx-auto p-8 bg-white dark:bg-gray-900 border-0 shadow-xl rounded-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Mission introuvable"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8",children:v instanceof Error?v.message:"Cette mission n'existe plus ou a été supprimée."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(p,{onClick:()=>window.location.reload(),variant:"outline",children:"Recharger"}),e.jsx(p,{onClick:m,className:"bg-blue-600 hover:bg-blue-700",children:"Fermer"})]})]})})});const oe=ze(s.category),D=s.bids?[...s.bids].sort((o,z)=>o.amount-z.amount):[],me=s.teamRequirements&&s.teamRequirements.length>0,we=o=>{d(o)};return e.jsxs($,{open:j,onOpenChange:m,children:[e.jsxs(I,{className:"w-[95vw] max-h-[90vh] max-w-4xl p-0 gap-0 bg-white dark:bg-gray-900 border-0 shadow-2xl rounded-xl overflow-hidden flex flex-col transition-all duration-300",children:[e.jsxs(de,{className:"sr-only",children:[e.jsx(ce,{children:s.title}),e.jsx(Te,{children:"Détails de la mission"})]}),e.jsxs("div",{className:"flex flex-col min-h-0 max-h-[90vh]",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6",children:[e.jsx(p,{onClick:m,size:"sm",variant:"ghost",className:"md:hidden p-2","aria-label":"Retour au marketplace",children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 min-w-0 md:pr-4",children:e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white leading-tight mb-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),s.clientName]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),s.budgetDisplay]}),oe&&e.jsx(w,{variant:"secondary",className:"text-xs",children:oe.name})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mr-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"}),D.length]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),s.createdAt?Q(s.createdAt):"Date non spécifiée"]})]}),e.jsx(p,{onClick:m,size:"sm",variant:"ghost",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800","aria-label":"Fermer",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:e.jsxs(je,{value:N,onValueChange:we,className:"w-full",children:[e.jsx(be,{className:"w-full bg-transparent rounded-none border-none p-0 h-auto",children:e.jsxs("div",{className:"flex w-full",children:[e.jsxs(A,{value:"overview",className:"flex-1 h-12 text-sm font-medium data-[state=active]:text-blue-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Détails"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]}),e.jsxs(A,{value:"bids",className:"flex-1 h-12 text-sm font-medium data-[state=active]:text-blue-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"Offres"}),e.jsx(w,{variant:"secondary",className:"text-xs",children:D.length})]}),me&&e.jsxs(A,{value:"team",className:"flex-1 h-12 text-sm font-medium data-[state=active]:text-blue-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border-b-2 data-[state=active]:border-blue-600 rounded-none",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Équipe"]})]})}),e.jsxs("div",{className:"flex-1 min-h-0",children:[e.jsx(B,{value:"overview",className:"m-0 h-full",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-blue-600"}),"Description du projet"]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed text-base",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Budget"}),e.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:s.budgetDisplay})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:s.location||"Non spécifié"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Candidatures"}),e.jsx("p",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:D.length})]})]})})]}),n&&n.type==="provider"&&s.clientName!==n.name&&e.jsx(Ge,{mission:s,user:n,sortedBids:D,showAIAnalyzer:h,setShowAIAnalyzer:a,showBidForm:_,setShowBidForm:l}),n&&n.type==="provider"&&s.clientName===n.name&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-blue-700 font-medium text-sm",children:"Ceci est votre mission"})]})})]})})}),e.jsx(B,{value:"bids",className:"m-0 h-full",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"p-6",children:D.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-12 text-center shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(M,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Aucune candidature"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Cette mission n'a pas encore reçu d'offres de prestataires"})]}):e.jsx("div",{className:"space-y-4",children:D.map((o,z)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:o.providerName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>{t(o.providerId),r(o.providerName)},children:o.providerName}),z===0&&D.length>1&&e.jsx(w,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:"Meilleure offre"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:re(o.rating||"5.0")}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[parseFloat(o.rating||"5.0").toFixed(1),"/5"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1",children:o.price||he(o.amount.toString())}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),o.timeline_days?`${o.timeline_days} jours`:"Non spécifié"]})]})]}),o.message&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:o.message})}),n&&(s.clientName===n.name||s.userName===n.name)&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(p,{onClick:()=>{y(o.id),S(o.providerName)},variant:"outline",className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Contacter"]}),e.jsxs(p,{className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Accepter l'offre"]})]})]},o.id))})})})}),me&&e.jsx(B,{value:"team",className:"m-0 h-full",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600"}),"Composition de l'équipe requise"]}),e.jsx("div",{className:"space-y-4",children:s.teamRequirements?.map((o,z)=>e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg p-5 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:o.role}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-3",children:o.description})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-xl font-bold text-green-600 dark:text-green-400 mb-1",children:he(o.budget||"0")}),e.jsxs(w,{variant:"outline",className:"text-sm",children:[o.quantity," personne",o.quantity>1?"s":""]})]})]}),o.skills&&o.skills.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 dark:text-gray-300 mb-3",children:"Compétences requises :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.skills.map((xe,K)=>e.jsx(w,{variant:"secondary",className:"text-sm px-3 py-1",children:xe},K))})]})]},z))})]})})})})]})]})})]})]}),e.jsx(Xe,{providerId:b,providerName:i,isOpen:!!b,onClose:()=>{t(null),r("")}}),e.jsx(Ze,{bidId:u,bidderName:k,isOpen:!!u,onClose:()=>{y(null),S("")}})]})}export{ws as M};
