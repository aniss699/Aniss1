import{r as b,j as e}from"./ui-BcXBiFQq.js";import{u as oe}from"./useQuery-C0jxRtIM.js";import{j as L,e as O,G as Ce,H as Se,L as g,I as M,B as h,J as qe,g as X,f as ae,U as T,q as re,P as se,C as w,a as z,i as A,l as Z,X as te,b as k,V as ie,Z as _e,D as me,m as xe,y as ue,n as pe,W as Re,h as Me,d as De,Y as Te,u as ze,O as ce,F as Ae}from"./index-vw13ZaSZ.js";import{d as Pe}from"./services-DKmuAkBs.js";import{f as U,g as $e,a as Ee}from"./categories-KhEpuZy7.js";import{T as F}from"./textarea-BzE0jqn5.js";import{T as he,a as ge,b as E,c as B}from"./tabs-CpT1oGj-.js";import{S as H,a as K,b as Q,c as G,d as q}from"./select-D_CM2fl0.js";import{B as S}from"./badge-BEnMm8eS.js";import{S as J}from"./star-lZmyPiKT.js";import{E as W}from"./euro-C5QXpPPr.js";import{C as I}from"./calendar-CrI0ZKgz.js";import{S as Be}from"./switch-CVU2XRQG.js";import{S as Fe}from"./settings-DDo4iGbr.js";import{G as Ie}from"./globe-DUOG5j9C.js";import{L as Ve}from"./lock-jDglxDqV.js";import{S as je}from"./smart-bid-analyzer-Bs154_qY.js";import{A as ve}from"./award-BmVY4YqN.js";import{M as V}from"./message-circle-CCGmyckt.js";import{A as Le}from"./availability-calendar-DniLZEAl.js";import{M as be}from"./map-pin-DrIQw4Y0.js";import{P as Oe}from"./phone-DbbT34Os.js";import{C as fe}from"./clock-4nNdWfoX.js";import{C as Ue}from"./circle-x-B1wvIn0B.js";import{C as He}from"./circle-alert-DRbBLegj.js";import"./vendor-D3F3s8fL.js";import"./index-DIYLGAU4.js";import"./triangle-alert-CJJmAxnI.js";import"./lightbulb-C7yTem-N.js";import"./trending-up-DJhDpJNX.js";import"./calendar-ESXLPKPk.js";import"./en-US-oEpl4HuW.js";import"./chevron-left-axwD6ARZ.js";import"./trash-2-Cc2RLBBt.js";import"./save-CTiOSYfn.js";import"./fr-Qfl_UVRO.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=L("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=L("HandHeart",[["path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1ifwr1"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"17abbs"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12Z",key:"1h3036"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=L("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=L("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=L("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function ye({missionId:n,onSuccess:f}){const{user:x}=O(),[o,y]=b.useState({amount:"",timeline:"",proposal:""}),d=Ce("/api/bids",{successMessage:"üöÄ Offre envoy√©e avec succ√®s !",errorContext:"Soumission d'offre",invalidateQueries:[["/api/missions",n],["/api/missions"],["/api/users",x?.id,"bids"]],onSuccess:()=>{y({amount:"",timeline:"",proposal:""}),f()}}),j=Se({onSubmit:async r=>{d.mutate(r)},validateBeforeSubmit:qe.validateBid}),t=r=>{if(r.preventDefault(),!x){j.handleError(new Error("Vous devez √™tre connect√© pour postuler"),"Authentification requise");return}j.handleSubmit({...o,missionId:n,providerId:x.id,providerName:x.name,amount:o.amount,rating:x.rating||"5.0"})},l=(r,u)=>{y(N=>({...N,[r]:u}))};return!x||x.type!=="provider"?null:e.jsx("div",{className:"bg-white rounded-lg p-1",children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"amount",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üí∞"}),e.jsx("span",{children:"Prix propos√© (‚Ç¨)"})]}),e.jsx(M,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Ex: 2500",value:o.amount,onChange:r=>l("amount",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-colors",required:!0,"data-testid":"input-bid-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"timeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"‚è±Ô∏è"}),e.jsx("span",{children:"D√©lai de livraison"})]}),e.jsx(M,{id:"timeline",type:"text",placeholder:"Ex: 4 semaines",value:o.timeline,onChange:r=>l("timeline",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-colors",required:!0,"data-testid":"input-bid-timeline"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"proposal",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìù"}),e.jsx("span",{children:"D√©crivez votre proposition"})]}),e.jsx(F,{id:"proposal",placeholder:"Expliquez votre approche, votre exp√©rience pertinente et ce que vous allez concr√®tement livrer pour cette mission...",value:o.proposal,onChange:r=>l("proposal",r.target.value),className:"min-h-[120px] rounded-lg border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-100 resize-none transition-colors",required:!0,"data-testid":"textarea-bid-proposal"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(h,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-lg text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]",disabled:d.isPending||j.isSubmitting,"data-testid":"button-submit-bid",children:d.isPending||j.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üöÄ"}),e.jsx("span",{children:"Envoyer ma candidature"})]})})})]})})}function Ge({missionId:n,onSuccess:f}){const{user:x}=O(),{toast:o}=X(),y=ae(),[d,j]=b.useState(!1),[t,l]=b.useState({amount:"",timeline_days:"",message:""}),[r,u]=b.useState([{name:x?.name||"",role:"Chef d'√©quipe",experience:"5+ ann√©es",isLead:!0,rating:4.5}]),N=()=>{const i={name:"",role:"",experience:"",isLead:!1,rating:4};u([...r,i])},C=(i,p,a)=>{const s=[...r];s[i]={...s[i],[p]:a},u(s)},_=i=>{if(i===0)return;const p=r.filter((a,s)=>s!==i);u(p)},R=async i=>{if(i.preventDefault(),!x){o({title:"Erreur",description:"Vous devez √™tre connect√© pour soumettre une offre",variant:"destructive"});return}if(!t.amount||!t.timeline_days||!t.message){o({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}if(r.length<2){o({title:"Erreur",description:"Une √©quipe doit avoir au moins 2 membres",variant:"destructive"});return}if(r.filter(a=>!a.name||!a.role||!a.experience).length>0){o({title:"Erreur",description:"Veuillez compl√©ter les informations de tous les membres de l'√©quipe",variant:"destructive"});return}j(!0);try{const a={members:r,total_budget:parseInt(t.amount),estimated_timeline:parseInt(t.timeline_days),description:t.message},m=await(await ie("POST","/api/bids",{mission_id:parseInt(n),amount:t.amount,timeline_days:parseInt(t.timeline_days),message:t.message,bid_type:"team",team_composition:a,team_lead_id:x.id})).json();o({title:"‚úÖ Candidature d'√©quipe soumise !",description:`Votre √©quipe de ${r.length} membres a √©t√© propos√©e avec succ√®s.`}),y.invalidateQueries({queryKey:["mission-detail",n]}),y.invalidateQueries({queryKey:["missions"]}),f()}catch(a){console.error("Erreur soumission candidature √©quipe:",a),o({title:"Erreur",description:a instanceof Error?a.message:"Impossible de soumettre la candidature",variant:"destructive"})}finally{j(!1)}};return!x||x.type!=="provider"?null:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Candidature d'√©quipe"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pr√©sentez votre √©quipe pr√©-constitu√©e pour cette mission"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Composition de l'√©quipe"]}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:N,"data-testid":"button-add-member",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((i,p)=>e.jsxs(w,{className:`${i.isLead?"ring-2 ring-purple-200 bg-purple-50":"bg-gray-50"}`,children:[e.jsx(z,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm flex items-center gap-2",children:i.isLead?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 text-purple-600"}),"Chef d'√©quipe"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4"}),"Membre ",p]})}),!i.isLead&&e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>_(p),"data-testid":`button-remove-member-${p}`,children:e.jsx(te,{className:"w-4 h-4"})})]})}),e.jsxs(k,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Nom complet *"}),e.jsx(M,{placeholder:"Nom du membre",value:i.name,onChange:a=>C(p,"name",a.target.value),disabled:i.isLead,"data-testid":`input-member-name-${p}`})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"R√¥le/Sp√©cialit√© *"}),e.jsx(M,{placeholder:"Ex: D√©veloppeur Frontend",value:i.role,onChange:a=>C(p,"role",a.target.value),"data-testid":`input-member-role-${p}`})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Exp√©rience *"}),e.jsxs(H,{value:i.experience,onValueChange:a=>C(p,"experience",a),children:[e.jsx(K,{"data-testid":`select-member-experience-${p}`,children:e.jsx(Q,{placeholder:"Niveau d'exp√©rience"})}),e.jsxs(G,{children:[e.jsx(q,{value:"1-2 ann√©es",children:"1-2 ann√©es"}),e.jsx(q,{value:"3-5 ann√©es",children:"3-5 ann√©es"}),e.jsx(q,{value:"5+ ann√©es",children:"5+ ann√©es"}),e.jsx(q,{value:"10+ ann√©es",children:"10+ ann√©es"})]})]})]})]})]},p))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"team-amount",className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Prix total √©quipe (‚Ç¨) *"]}),e.jsx(M,{id:"team-amount",type:"number",placeholder:"15000",min:"100",value:t.amount,onChange:i=>l(p=>({...p,amount:i.target.value})),"data-testid":"input-team-amount"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Montant global pour toute l'√©quipe"})]}),e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"team-timeline",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"D√©lai (jours) *"]}),e.jsx(M,{id:"team-timeline",type:"number",placeholder:"30",min:"1",value:t.timeline_days,onChange:i=>l(p=>({...p,timeline_days:i.target.value})),"data-testid":"input-team-timeline"})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"team-message",className:"text-base font-medium",children:"Proposition d√©taill√©e *"}),e.jsx(F,{id:"team-message",placeholder:"D√©crivez comment votre √©quipe va r√©aliser cette mission, la r√©partition des t√¢ches, votre m√©thodologie...",rows:5,value:t.message,onChange:i=>l(p=>({...p,message:i.target.value})),"data-testid":"textarea-team-message"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"D√©taillez la strat√©gie de votre √©quipe pour cette mission"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"R√©capitulatif de l'√©quipe"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres:"}),e.jsxs(S,{variant:"secondary",children:[r.length," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget total:"}),e.jsxs(S,{variant:"secondary",children:[t.amount||"0","‚Ç¨"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"D√©lai:"}),e.jsxs(S,{variant:"secondary",children:[t.timeline_days||"0"," jours"]})]})]})]}),e.jsx(h,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:d,"data-testid":"button-submit-team-bid",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Soumission en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Soumettre la candidature d'√©quipe"]})})]})}function Ze({missionId:n,onSuccess:f}){const{user:x}=O(),{toast:o}=X(),y=ae(),[d,j]=b.useState(!1),[t,l]=b.useState({name:"",description:"",estimated_budget:"",estimated_timeline_days:"",max_members:"5",visibility:"public",auto_accept:!0}),[r,u]=b.useState([{title:"",description:"",skills:[],min_experience:1,priority:"medium"}]),N=()=>{const a={title:"",description:"",skills:[],min_experience:1,priority:"medium"};u([...r,a])},C=(a,s,m)=>{const v=[...r];v[a]={...v[a],[s]:m},u(v)},_=a=>{if(r.length<=1)return;const s=r.filter((m,v)=>v!==a);u(s)},R=(a,s)=>{if(!s.trim())return;const m=[...r],v=m[a].skills;v.includes(s.trim())||(m[a].skills=[...v,s.trim()],u(m))},i=(a,s)=>{const m=[...r];m[a].skills=m[a].skills.filter((v,Y)=>Y!==s),u(m)},p=async a=>{if(a.preventDefault(),!x){o({title:"Erreur",description:"Vous devez √™tre connect√© pour cr√©er une √©quipe ouverte",variant:"destructive"});return}if(!t.name||!t.description||!t.estimated_budget||!t.estimated_timeline_days){o({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}const s=r.filter(m=>m.title.trim());if(s.length===0){o({title:"Erreur",description:"Veuillez d√©finir au moins un r√¥le recherch√©",variant:"destructive"});return}j(!0);try{const v=await(await ie("POST","/api/open-teams",{mission_id:parseInt(n),name:t.name,description:t.description,estimated_budget:parseInt(t.estimated_budget)*100,estimated_timeline_days:parseInt(t.estimated_timeline_days),max_members:parseInt(t.max_members),visibility:t.visibility,auto_accept:t.auto_accept,required_roles:s,members:[{user_id:x.id,name:x.name,role:"Initiateur",experience_years:5,rating:4.5,joined_at:new Date().toISOString()}]})).json();o({title:"üöÄ √âquipe ouverte cr√©√©e !",description:`${t.name} est maintenant ouverte au recrutement.`}),y.invalidateQueries({queryKey:["mission-detail",n]}),y.invalidateQueries({queryKey:["open-teams"]}),f()}catch(m){console.error("Erreur cr√©ation √©quipe ouverte:",m),o({title:"Erreur",description:m instanceof Error?m.message:"Impossible de cr√©er l'√©quipe ouverte",variant:"destructive"})}finally{j(!1)}};return!x||x.type!=="provider"?null:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Cr√©er une √©quipe ouverte"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Initiez une √©quipe o√π d'autres prestataires peuvent vous rejoindre"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"team-name",className:"text-base font-medium",children:"Nom de l'√©quipe *"}),e.jsx(M,{id:"team-name",placeholder:"Ex: √âquipe D√©veloppement Web Pro",value:t.name,onChange:a=>l(s=>({...s,name:a.target.value})),"data-testid":"input-team-name"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"team-description",className:"text-base font-medium",children:"Description de l'√©quipe *"}),e.jsx(F,{id:"team-description",placeholder:"D√©crivez votre approche, votre vision pour cette mission...",rows:3,value:t.description,onChange:a=>l(s=>({...s,description:a.target.value})),"data-testid":"textarea-team-description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"estimated-budget",className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Budget estim√© (‚Ç¨) *"]}),e.jsx(M,{id:"estimated-budget",type:"number",placeholder:"10000",min:"100",value:t.estimated_budget,onChange:a=>l(s=>({...s,estimated_budget:a.target.value})),"data-testid":"input-estimated-budget"})]}),e.jsxs("div",{children:[e.jsxs(g,{htmlFor:"estimated-timeline",className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"D√©lai estim√© (jours) *"]}),e.jsx(M,{id:"estimated-timeline",type:"number",placeholder:"45",min:"1",value:t.estimated_timeline_days,onChange:a=>l(s=>({...s,estimated_timeline_days:a.target.value})),"data-testid":"input-estimated-timeline"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"R√¥les recherch√©s"]}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:N,"data-testid":"button-add-role",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((a,s)=>e.jsxs(w,{className:"bg-orange-50 border-orange-200",children:[e.jsx(z,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"text-sm",children:["R√¥le ",s+1]}),r.length>1&&e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>_(s),"data-testid":`button-remove-role-${s}`,children:e.jsx(te,{className:"w-4 h-4"})})]})}),e.jsxs(k,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Titre du poste *"}),e.jsx(M,{placeholder:"Ex: D√©veloppeur React",value:a.title,onChange:m=>C(s,"title",m.target.value),"data-testid":`input-role-title-${s}`})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Priorit√©"}),e.jsxs(H,{value:a.priority,onValueChange:m=>C(s,"priority",m),children:[e.jsx(K,{"data-testid":`select-role-priority-${s}`,children:e.jsx(Q,{})}),e.jsxs(G,{children:[e.jsx(q,{value:"high",children:"Haute"}),e.jsx(q,{value:"medium",children:"Moyenne"}),e.jsx(q,{value:"low",children:"Basse"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Description du r√¥le"}),e.jsx(F,{placeholder:"D√©crivez les responsabilit√©s et attentes...",rows:2,value:a.description,onChange:m=>C(s,"description",m.target.value),"data-testid":`textarea-role-description-${s}`})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Comp√©tences requises"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.skills.map((m,v)=>e.jsxs(S,{variant:"secondary",className:"flex items-center gap-1",children:[m,e.jsx(te,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>i(s,v)})]},v))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{placeholder:"Ajouter une comp√©tence...",onKeyPress:m=>{m.key==="Enter"&&(m.preventDefault(),R(s,m.currentTarget.value),m.currentTarget.value="")},"data-testid":`input-role-skill-${s}`}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:m=>{const v=m.currentTarget.parentNode?.querySelector("input");v&&(R(s,v.value),v.value="")},children:e.jsx(se,{className:"w-4 h-4"})})]})]})]})]},s))})]}),e.jsxs(w,{className:"bg-gray-50",children:[e.jsx(z,{children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Param√®tres de l'√©quipe"]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Nombre max de membres"}),e.jsxs(H,{value:t.max_members,onValueChange:a=>l(s=>({...s,max_members:a})),children:[e.jsx(K,{"data-testid":"select-max-members",children:e.jsx(Q,{})}),e.jsxs(G,{children:[e.jsx(q,{value:"3",children:"3 membres"}),e.jsx(q,{value:"5",children:"5 membres"}),e.jsx(q,{value:"7",children:"7 membres"}),e.jsx(q,{value:"10",children:"10 membres"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-sm",children:"Visibilit√©"}),e.jsxs(H,{value:t.visibility,onValueChange:a=>l(s=>({...s,visibility:a})),children:[e.jsx(K,{"data-testid":"select-visibility",children:e.jsx(Q,{})}),e.jsxs(G,{children:[e.jsx(q,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Publique"]})}),e.jsx(q,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Priv√©e"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{id:"auto-accept",checked:t.auto_accept,onCheckedChange:a=>l(s=>({...s,auto_accept:a})),"data-testid":"switch-auto-accept"}),e.jsx(g,{htmlFor:"auto-accept",className:"text-sm",children:"Accepter automatiquement les candidatures"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"R√©capitulatif de l'√©quipe ouverte"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Nom:"}),e.jsx(S,{variant:"secondary",children:t.name||"Non d√©fini"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget estim√©:"}),e.jsxs(S,{variant:"secondary",children:[t.estimated_budget||"0","‚Ç¨"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres max:"}),e.jsxs(S,{variant:"secondary",children:[t.max_members," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"R√¥les d√©finis:"}),e.jsxs(S,{variant:"secondary",children:[r.filter(a=>a.title).length," r√¥les"]})]})]})]}),e.jsx(h,{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-700",disabled:d,"data-testid":"button-submit-open-team",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Cr√©ation en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Cr√©er l'√©quipe ouverte"]})})]})}function We({mission:n,user:f,sortedBids:x,showAIAnalyzer:o,setShowAIAnalyzer:y,showBidForm:d,setShowBidForm:j}){const[t,l]=b.useState("individual"),[r,u]=b.useState(!1),[N,C]=b.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 md:p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:"Candidater √† cette mission"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Choisissez votre mode de candidature"})]})]}),e.jsxs(he,{value:t,onValueChange:_=>l(_),className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(E,{value:"individual",className:"text-xs md:text-sm data-[testid=tab-individual]","data-testid":"tab-individual",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Solo"]}),e.jsxs(E,{value:"team",className:"text-xs md:text-sm","data-testid":"tab-team",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"√âquipe"]}),e.jsxs(E,{value:"open_team",className:"text-xs md:text-sm","data-testid":"tab-open-team",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"√âquipe Ouverte"]})]}),e.jsx(B,{value:"individual",className:"space-y-4 mt-0",children:e.jsxs(w,{className:"bg-blue-50 border-blue-200",children:[e.jsx(z,{className:"pb-3",children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Candidature individuelle"]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez seul √† cette mission avec votre expertise."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(h,{onClick:()=>y(!o),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-sm",size:"default","data-testid":"button-ai-analyzer",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Analyser avec l'IA"]}),e.jsxs(h,{onClick:()=>j(!d),className:"w-full bg-green-600 hover:bg-green-700 text-sm",size:"default","data-testid":"button-submit-individual",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),d?"Masquer le formulaire":"Soumettre une offre"]})]}),o&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(je,{missionTitle:n.title,missionDescription:n.description,missionBudget:parseFloat(n.budget||"0"),missionCategory:n.category,currentBid:{price:0,timeline:"",proposal:""},providerProfile:{rating:4.5,completedProjects:25,skills:["React","Node.js","TypeScript"],portfolio:[]},competitorBids:x,onOptimizedBidGenerated:_=>{j(!0)}})}),d&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(ye,{missionId:n.id,onSuccess:()=>{j(!1),y(!1)}})})]})]})}),e.jsx(B,{value:"team",className:"space-y-4 mt-0",children:e.jsxs(w,{className:"bg-purple-50 border-purple-200",children:[e.jsx(z,{className:"pb-3",children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Candidature d'√©quipe"]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez avec une √©quipe pr√©-constitu√©e que vous dirigez."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg border",children:[e.jsx(J,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vous √™tes le chef d'√©quipe"})]}),e.jsxs(h,{onClick:()=>u(!r),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",size:"default","data-testid":"button-submit-team",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),r?"Masquer le formulaire":"Candidater en √©quipe"]})]}),r&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ge,{missionId:n.id,onSuccess:()=>{u(!1)}})})]})]})}),e.jsx(B,{value:"open_team",className:"space-y-4 mt-0",children:e.jsxs(w,{className:"bg-orange-50 border-orange-200",children:[e.jsx(z,{className:"pb-3",children:e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"√âquipe ouverte"]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Cr√©ez une √©quipe ouverte o√π d'autres prestataires peuvent vous rejoindre."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Ne,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Recrutement ouvert"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Ke,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Collaboration"})]})]}),e.jsxs(h,{onClick:()=>C(!N),className:"w-full bg-orange-600 hover:bg-orange-700 text-sm",size:"default","data-testid":"button-submit-open-team",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),N?"Masquer le formulaire":"Cr√©er une √©quipe ouverte"]})]}),N&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ze,{missionId:n.id,onSuccess:()=>{C(!1)}})})]})]})})]})]})}function Xe({providerId:n,providerName:f,isOpen:x,onClose:o}){const{toast:y}=X(),{data:d,isLoading:j}=oe({queryKey:["/api/providers",n,"profile"],enabled:!!n&&x}),t=l=>Array.from({length:5},(r,u)=>e.jsx(J,{className:`w-4 h-4 ${u<l?"text-yellow-400 fill-current":"text-gray-300"}`},u));return!x||!n?null:e.jsx(me,{open:x,onOpenChange:o,children:e.jsxs(xe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ue,{children:e.jsx(pe,{asChild:!0,children:e.jsx(Re,{children:"Profil du prestataire"})})}),e.jsx("div",{className:"p-6"}),j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):d?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:d.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),d.location||"Localisation non sp√©cifi√©e"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Membre depuis ",U(d.joinedAt)]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:d.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end mb-2",children:[e.jsx("div",{className:"flex items-center mr-2",children:t(Math.round(parseFloat(d.rating)))}),e.jsx("span",{className:"text-xl font-bold",children:d.rating})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[d.totalProjects," projets r√©alis√©s"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.skills.map((l,r)=>e.jsx(S,{variant:"secondary",children:l},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs(h,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{window.location.href=`/messages?contact=${n}&name=${encodeURIComponent(f)}`},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(h,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",onClick:()=>{y({title:"Contacter le prestataire",description:`Appelez ${f} pour discuter du projet`})},children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Appeler"]}),e.jsxs(h,{className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white",onClick:()=>{y({title:"R√©servation de cr√©neau",description:`Fonctionnalit√© de r√©servation avec ${f} en cours de d√©veloppement`})},children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"R√©server un cr√©neau"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"R√©alisations r√©centes"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:d.portfolio.slice(0,4).map(l=>e.jsx(w,{children:e.jsxs(k,{className:"p-4",children:[l.images.length>0&&e.jsx("img",{src:l.images[0],alt:l.title,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:l.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:l.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(S,{variant:"outline",children:l.category}),e.jsx("span",{className:"text-xs text-gray-500",children:U(l.completedAt)})]})]})},l.id))}),d.portfolio.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune r√©alisation disponible pour le moment"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 mr-2"}),"Disponibilit√©s"]}),e.jsx(w,{children:e.jsx(k,{className:"p-4",children:e.jsx(Le,{readOnly:!0,initialAvailability:d.availability||[]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ve,{className:"w-5 h-5 mr-2"}),"Avis clients (",d.evaluations.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:d.evaluations.map(l=>e.jsx(w,{children:e.jsxs(k,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[t(l.rating),e.jsx("span",{className:"ml-2 font-medium",children:l.clientName})]}),e.jsx("span",{className:"text-xs text-gray-500",children:U(l.createdAt)})]})}),e.jsx("p",{className:"text-gray-700 mb-3",children:l.comment}),l.photos&&l.photos.length>0&&e.jsx("div",{className:"flex space-x-2",children:l.photos.slice(0,3).map((r,u)=>e.jsx("img",{src:r,alt:`Photo ${u+1}`,className:"w-16 h-16 object-cover rounded-lg"},u))})]})},l.id))}),d.evaluations.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun avis client pour le moment"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{onClick:o,children:"Fermer"})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Profil non trouv√©"})})]})})}function Je({bidId:n,bidderName:f,isOpen:x,onClose:o}){const{user:y}=O(),{toast:d}=X(),j=ae(),[t,l]=b.useState(null),[r,u]=b.useState(""),N=Me({mutationFn:async i=>(await ie("POST","/api/bids/respond",i)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/missions"]});const i=t==="accept"?"accept√©e":t==="reject"?"d√©clin√©e":"en n√©gociation";d({title:"R√©ponse envoy√©e !",description:`Votre r√©ponse (${i}) a √©t√© envoy√©e au prestataire. Il recevra une notification.`}),setTimeout(()=>{alert(`Confirmation : Votre r√©ponse "${i}" a bien √©t√© envoy√©e √† ${f}. Un email de confirmation lui a √©t√© envoy√©.`)},500),o(),l(null),u("")},onError:i=>{d({title:"Erreur",description:i.message||"Une erreur est survenue",variant:"destructive"})}}),C=i=>{if(i.preventDefault(),!t){d({title:"Action requise",description:"Veuillez choisir une action",variant:"destructive"});return}if(t==="negotiate"&&!r.trim()){d({title:"Message requis",description:"Veuillez ajouter un message pour n√©gocier",variant:"destructive"});return}N.mutate({bidId:n,status:t,message:r.trim()||null,clientResponse:t})},_=i=>{switch(i){case"accept":return`Bonjour ${f},

Nous avons le plaisir de vous informer que votre offre a √©t√© retenue pour ce projet. Nous allons proc√©der √† la mise en place du contrat.

Cordialement`;case"reject":return`Bonjour ${f},

Nous vous remercions pour votre offre. Malheureusement, nous avons d√©cid√© de retenir une autre proposition pour ce projet.

Cordialement`;case"negotiate":return`Bonjour ${f},

Votre offre nous int√©resse. Cependant, nous aimerions discuter de certains points :

- 
- 

√ätes-vous ouvert √† la n√©gociation ?

Cordialement`}},R=i=>{l(i),u(_(i))};return e.jsx(me,{open:x,onOpenChange:o,children:e.jsxs(xe,{className:"sm:max-w-2xl bg-white border shadow-lg",children:[e.jsx(ue,{children:e.jsxs(pe,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(V,{className:"w-6 h-6 text-blue-500"}),"R√©pondre √† l'offre de ",f]})}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choisissez votre r√©ponse :"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>R("accept"),className:`p-4 rounded-xl border-2 transition-all ${t==="accept"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(De,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"font-semibold",children:"Accepter"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Retenir cette offre"})]}),e.jsxs("button",{type:"button",onClick:()=>R("negotiate"),className:`p-4 rounded-xl border-2 transition-all ${t==="negotiate"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx(V,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"font-semibold",children:"N√©gocier"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Demander des ajustements"})]}),e.jsxs("button",{type:"button",onClick:()=>R("reject"),className:`p-4 rounded-xl border-2 transition-all ${t==="reject"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-red-300"}`,children:[e.jsx(Ue,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"font-semibold",children:"D√©cliner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ne pas retenir"})]})]})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"message",className:"text-sm font-semibold text-gray-800",children:["Message √† ",f]}),e.jsx(F,{id:"message",value:r,onChange:i=>u(i.target.value),placeholder:"Votre message...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:o,className:"flex-1",disabled:N.isPending,children:"Annuler"}),e.jsx(h,{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600",disabled:!t||N.isPending,children:N.isPending?"Envoi...":"Envoyer la r√©ponse"})]})]})]})})}function $s(){const{user:n}=O(),f=Te(),[,x]=ze(),o=f.id,[y,d]=b.useState("overview"),[j,t]=b.useState(null),[l,r]=b.useState(""),[u,N]=b.useState(null),[C,_]=b.useState(""),[R,i]=b.useState(!1),[p,a]=b.useState(!1),{data:s,isLoading:m,error:v}=oe({queryKey:["mission-detail",o],queryFn:async()=>{if(!o)throw new Error("ID de mission manquant");console.log("üîç Chargement mission avec mappers ID:",o);const c=await Pe.getMissionById(o);return console.log("‚úÖ Mission normalis√©e charg√©e:",c.title),c},enabled:!!o,retry:1,retryDelay:2e3,staleTime:3e4});b.useEffect(()=>{if(s){document.title=`${s.title} - SwipDEAL`;const c=document.querySelector('meta[name="description"]');c&&c.setAttribute("content",`Mission: ${s.title} - Budget: ${s.budgetDisplay} - ${s.description.slice(0,150)}...`)}},[s]);const Y=c=>{const $=parseFloat(c);return Array.from({length:5},(Ye,ne)=>e.jsx(J,{className:`w-4 h-4 ${ne<Math.floor($)?"text-yellow-400 fill-current":"text-gray-300 dark:text-gray-600"}`},ne))};if(m)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Chargement de la mission"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"R√©cup√©ration des d√©tails..."})]})]})})})});if(v||!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center mt-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(He,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:"Mission introuvable"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8",children:v instanceof Error?v.message:"Cette mission n'existe plus ou a √©t√© supprim√©e."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(h,{onClick:()=>window.location.reload(),variant:"outline",children:"Recharger"}),e.jsxs(h,{onClick:()=>x("/marketplace"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Retour au marketplace"]})]})]})})});const le=$e(s.category),D=s.bids?[...s.bids].sort((c,$)=>c.amount-$.amount):[],ee=s.teamRequirements&&s.teamRequirements.length>0,we=()=>n&&n.type==="client"&&s.clientName===n.name&&D.length>0?"bids":ee&&n&&n.type==="provider"&&s.clientName!==n.name?"team":"overview";b.useEffect(()=>{if(s){const c=we();d(c),t(null),r(""),N(null),_(""),i(!1),a(!1)}},[s?.id,n?.id]);const ke=c=>{d(c),console.log(`üìä Navigation vers l'onglet: ${c} pour mission ${s.id}`)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(h,{onClick:()=>x("/marketplace"),variant:"ghost",className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800","data-testid":"button-back-marketplace",children:[e.jsx(ce,{className:"w-4 h-4"}),"Retour au marketplace"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),D.length," candidature",D.length!==1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4"}),s.createdAt?U(s.createdAt):"Date non sp√©cifi√©e"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3","data-testid":"text-mission-title",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1","data-testid":"text-client-name",children:[e.jsx(Z,{className:"w-4 h-4"}),s.clientName]}),e.jsxs("span",{className:"flex items-center gap-1","data-testid":"text-budget",children:[e.jsx(W,{className:"w-4 h-4"}),s.budgetDisplay]}),le&&e.jsx(S,{variant:"secondary",className:"text-xs","data-testid":"badge-category",children:le.name})]})]})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(he,{value:y,onValueChange:ke,className:"w-full",children:[e.jsxs(ge,{className:"w-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-1 mb-6",children:[e.jsxs(E,{value:"overview",className:"flex-1 flex items-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400","data-testid":"tab-overview",children:[e.jsx(Ae,{className:"w-4 h-4"}),"D√©tails"]}),e.jsxs(E,{value:"bids",className:"flex-1 flex items-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400","data-testid":"tab-bids",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Offres",e.jsx(S,{variant:"secondary",className:"text-xs ml-1",children:D.length})]}),ee&&e.jsxs(E,{value:"team",className:"flex-1 flex items-center gap-2 data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600 dark:data-[state=active]:bg-blue-900/30 dark:data-[state=active]:text-blue-400","data-testid":"tab-team",children:[e.jsx(P,{className:"w-4 h-4"}),"√âquipe",e.jsx(S,{variant:"secondary",className:"text-xs ml-1",children:s.teamRequirements?.length||0})]})]}),e.jsxs(B,{value:"overview",className:"space-y-6","data-testid":"content-overview",children:[e.jsxs(w,{children:[e.jsx(z,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Description du projet"]})}),e.jsx(k,{children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":"text-description",children:s.description})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(w,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Budget"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400","data-testid":"text-budget-amount",children:s.budgetDisplay})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(be,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white","data-testid":"text-location",children:s.location||"Non sp√©cifi√©"})]})]})})}),e.jsx(w,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Candidatures"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400","data-testid":"text-bids-count",children:D.length})]})]})})})]}),n&&n.type==="provider"&&s.clientName!==n.name&&e.jsx(We,{mission:s,user:n,sortedBids:D,showAIAnalyzer:p,setShowAIAnalyzer:a,showBidForm:R,setShowBidForm:i}),n&&n.type==="provider"&&s.clientName===n.name&&e.jsx(w,{className:"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Ceci est votre mission"})]})})})]}),e.jsx(B,{value:"bids",className:"space-y-6","data-testid":"content-bids",children:D.length===0?e.jsx(w,{children:e.jsxs(k,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(T,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Aucune candidature"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Cette mission n'a pas encore re√ßu d'offres de prestataires"})]})}):e.jsx("div",{className:"space-y-6",children:D.map((c,$)=>e.jsx(w,{className:"hover:shadow-md transition-all duration-200","data-testid":`card-bid-${c.id}`,children:e.jsxs(k,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-lg",children:c.providerName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>{t(c.providerId),r(c.providerName)},"data-testid":`text-provider-${c.id}`,children:c.providerName}),$===0&&D.length>1&&e.jsx(S,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:"Meilleure offre"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:Y("5.0")}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"5.0/5"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1","data-testid":`text-bid-amount-${c.id}`,children:c.price||Ee(c.amount.toString())}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),c.timeline_days?`${c.timeline_days} jours`:"Non sp√©cifi√©"]})]})]}),c.message&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":`text-bid-message-${c.id}`,children:c.message})}),n&&s.clientName===n.name&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(h,{onClick:()=>{N(c.id),_(c.providerName)},variant:"outline",className:"flex items-center gap-2","data-testid":`button-contact-${c.id}`,children:[e.jsx(V,{className:"w-4 h-4"}),"Contacter"]}),e.jsxs(h,{className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2","data-testid":`button-accept-${c.id}`,children:[e.jsx(de,{className:"w-4 h-4"}),"Accepter l'offre"]})]})]})},c.id))})}),ee&&e.jsx(B,{value:"team",className:"space-y-6","data-testid":"content-team",children:e.jsxs(w,{children:[e.jsx(z,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-600"}),"Exigences d'√©quipe"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:s.teamRequirements?.map((c,$)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:c.profession}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-3",children:c.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium",children:[c.estimated_budget,"‚Ç¨"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[c.min_experience," ans d'exp√©rience"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[c.estimated_days," jours"]})]})]},$))})})]})})]})}),e.jsx(Xe,{providerId:j,providerName:l,isOpen:!!j,onClose:()=>{t(null),r("")}}),e.jsx(Je,{bidId:u,bidderName:C,isOpen:!!u,onClose:()=>{N(null),_("")}}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(ye,{missionId:o,onSuccess:()=>{i(!1),window.location.reload()}})})}),p&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Analyse IA de la mission"}),e.jsx(h,{onClick:()=>a(!1),variant:"ghost",size:"sm",children:"‚úï"})]}),e.jsx(je,{missionId:o,onRecommendationApplied:()=>{a(!1),i(!0)}})]})})})]})}export{$s as default};
