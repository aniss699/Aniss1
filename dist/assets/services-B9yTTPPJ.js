function l(e){const s=e.budget_value_cents?Math.round(e.budget_value_cents/100):e.budget?typeof e.budget=="string"?parseInt(e.budget,10):e.budget:0;return{id:e.id,title:e.title||"",description:e.description||"",category:e.category||"",budget:s,budgetDisplay:`${s.toLocaleString()}€`,location:e.location||e.location_data?.city,clientName:e.clientName||e.client_name||`Client #${e.user_id||e.client_id}`,createdAt:e.createdAt||e.created_at||new Date().toISOString(),status:e.status||"draft",urgency:e.urgency,bids:e.bids?e.bids.map(d):[],teamRequirements:e.teamRequirements||e.team_requirements}}function d(e){const s=e.amount?typeof e.amount=="string"?parseFloat(e.amount):e.amount:e.price?parseFloat(e.price):0;return{id:e.id,providerId:e.providerId||e.provider_id,providerName:e.providerName||e.provider_name,amount:s,price:`${s}€`,message:e.message,bid_type:e.bid_type,timeline_days:e.timeline_days,status:e.status}}function c(e){return{id:e.id,title:e.title||"",description:e.description||e.content||"",category:e.category||"",budgetMin:e.budgetMin||e.budget_min,budgetMax:e.budgetMax||e.budget_max,deadline:e.deadline?new Date(e.deadline):void 0,city:e.city||e.location,userId:e.userId||e.user_id,tags:e.tags||[],sponsored:e.sponsored||!1,qualityScore:e.qualityScore||e.quality_score||.8}}const g=l,i=e=>new Promise(s=>setTimeout(s,e)),p={async createFlashDeal(e){return await i(400),console.log("Creating flash deal:",e),{success:!0,id:`flash_${Date.now()}`}},async createReverseSubscription(e){return await i(500),console.log("Creating reverse subscription:",e),{success:!0,id:`sub_${Date.now()}`}},async createGroupRequest(e){return await i(350),console.log("Creating group request:",e),{success:!0,id:`group_${Date.now()}`}},async getGroupInterest(e,s){return await i(300),{count:Math.floor(Math.random()*15)+1}},async aiDraftBrief(e){return await i(600),console.log("AI drafting brief for:",e),{scope:`Analyse du besoin : ${e.substring(0,100)}...`,deliverables:["Cahier des charges détaillé","Maquettes fonctionnelles","Planning de réalisation","Estimation budgétaire précise"],risks:["Délais serrés potentiels","Complexité technique à évaluer","Besoin de clarifications complémentaires"],checklist:["Validation du périmètre fonctionnel","Définition des critères d'acceptation","Planification des points de contrôle","Mise en place des outils de suivi"]}},async createIaHumanJob(e){return await i(400),console.log("Creating IA+Human job with brief:",e),{success:!0,id:`ia_${Date.now()}`}},async getLiveSlots(e={}){await i(450),console.log("Fetching live slots with filters:",e);const s=["Alice M.","Thomas B.","Sophie L.","Marc D.","Emma P."],r=["Développement","Design","Marketing","Conseil","Formation"];return Array.from({length:8},(t,o)=>({id:`slot_${o}_${Date.now()}`,providerName:s[Math.floor(Math.random()*s.length)],rating:4+Math.random(),slot:new Date(Date.now()+Math.random()*7*24*60*60*1e3).toISOString(),duration:[30,60,90,120][Math.floor(Math.random()*4)],pricePerHour:Math.floor(Math.random()*80)+40,distance:Math.floor(Math.random()*20)+1,tags:r.slice(0,Math.floor(Math.random()*3)+1)}))},async reserveSlot(e){return await i(300),console.log("Reserving slot:",e),{success:!0}}},m={async getMissions(){const e=await fetch("/api/missions",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!e.ok){const n=await e.text();throw console.error("❌ Erreur API missions:",e.status,n),new Error(`Erreur ${e.status}: ${e.statusText}`)}const s=await e.json();let r=[],t={total:0};s.missions&&Array.isArray(s.missions)?(r=s.missions,t=s.metadata||{total:s.missions.length}):Array.isArray(s)&&(r=s,t={total:s.length});const o=r.map(n=>l(n));return console.log("✅ Missions normalisées avec mappers:",o.length),{missions:o,metadata:t}},async getUserMissions(e){const s=await fetch(`/api/missions/users/${e}/missions`);if(!s.ok){const o=await s.text();throw console.error("❌ Erreur API missions utilisateur:",s.status,o),new Error(`Erreur ${s.status}: ${s.statusText}`)}const t=(await s.json()).map(o=>l(o));return console.log("✅ Missions utilisateur normalisées:",t.length),t},async getUserBids(e){const s=await fetch(`/api/missions/users/${e}/bids`);if(!s.ok)throw new Error("Failed to fetch user bids");const t=(await s.json()).map(o=>d(o));return console.log("✅ Bids utilisateur normalisés:",t.length),t},async getMissionById(e){if(console.log("🔍 API Service - getMissionById appelé avec ID:",e),!e||e==="undefined"||e==="null")throw console.error("❌ API Service - ID invalide:",e),new Error("ID de mission invalide");const s=await fetch(`/api/missions/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("🔍 API Service - Réponse reçue:",s.status,s.statusText),!s.ok){const o=await s.text();throw console.error("❌ Erreur API mission:",s.status,o),new Error(`Erreur ${s.status}: ${s.statusText}`)}const r=await s.json();console.log("🔍 API Service - Données brutes reçues:",{id:r.id,title:r.title,hasBids:!!r.bids});const t=g(r);return console.log("✅ Mission normalisée:",t.title,"avec",t.bids?.length||0,"offres"),t},async getFeed(e,s=10){const r=new URLSearchParams({limit:s.toString()});e&&r.append("cursor",e);const t=await fetch(`/api/feed?${r}`);if(!t.ok)throw new Error("Erreur lors du chargement du feed");const a=((await t.json()).items||[]).map(u=>c(u));return console.log("✅ Feed normalisé:",a.length,"annonces"),{items:a,hasMore:a.length===s}},async getFavorites(e){const s=await fetch(`/api/favorites?user_id=${e}`);if(!s.ok)throw new Error("Erreur lors du chargement des favoris");const o=((await s.json()).favorites||[]).map(n=>c(n));return console.log("✅ Favoris normalisés:",o.length),o}};export{m as d,p as s};
