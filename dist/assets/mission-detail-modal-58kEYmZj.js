import{r as f,j as e}from"./ui-BcXBiFQq.js";import{u as je}from"./useQuery-6dssjzsm.js";import{i as se,d as U,j as we,k as Ce,v as Se,L as j,I as k,B as h,f as te,e as le,U as M,l as ne,P as ie,C as z,a as E,h as F,m as Y,X as ee,b as D,n as de,Z as qe,D as $,o as I,q as ce,r as me,V as ke,g as _e,s as Te,t as Re,T as pe}from"./index-DJc2pR2N.js";import{a as G,g as Me,f as H}from"./categories-Ci5EyH-Y.js";import{T as ge,a as ve,b as P,c as A}from"./tabs-06jBCTOh.js";import{T as V}from"./textarea-DuOO2edZ.js";import{S as X,a as Z,b as W,c as J,d as S}from"./select-BzgbFAq-.js";import{B as w}from"./badge-CFI7mfJU.js";import{S as ae}from"./star-Cphyr6se.js";import{E as oe}from"./euro-Ch6Jz0s-.js";import{C as L}from"./calendar-DU1X_zQD.js";import{S as ze}from"./switch-BzpZRQHG.js";import{S as De}from"./settings-6SgoK51F.js";import{G as Ee}from"./globe-Bw38QZw4.js";import{L as Fe}from"./lock-Bjy180yT.js";import{S as Pe}from"./smart-bid-analyzer-8ZwSh9Ey.js";import{A as be}from"./award-DyWz3uMJ.js";import{M as O}from"./message-circle-xeCDZ-bV.js";import{A as Ae}from"./availability-calendar-jF5lek7t.js";import{M as fe}from"./map-pin-Dq_Ktkma.js";import{P as Be}from"./phone-uzsj4Ggg.js";import{C as Ne}from"./clock-BWV3DtQF.js";import{C as $e}from"./circle-x-GXcwK1pg.js";import{C as Ie}from"./circle-alert-1Rp3hom4.js";import{C as Ve}from"./chevron-left-BegeVObJ.js";import{E as Le}from"./eye-D1_kmyK-.js";import{T as Oe}from"./trending-up-CmG3oNft.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=se("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=se("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=se("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=se("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function Ke({missionId:x,onSuccess:g}){const{user:o}=U(),[d,N]=f.useState({amount:"",timeline:"",proposal:""}),c=we("/api/bids",{successMessage:"🚀 Offre envoyée avec succès !",errorContext:"Soumission d'offre",invalidateQueries:[["/api/missions",x],["/api/missions"],["/api/users",o?.id,"bids"]],onSuccess:()=>{N({amount:"",timeline:"",proposal:""}),g()}}),v=Ce({onSubmit:async r=>{c.mutate(r)},validateBeforeSubmit:Se.validateBid}),t=r=>{if(r.preventDefault(),!o){v.handleError(new Error("Vous devez être connecté pour postuler"),"Authentification requise");return}v.handleSubmit({...d,missionId:x,providerId:o.id,providerName:o.name,amount:d.amount,rating:o.rating||"5.0"})},i=(r,u)=>{N(y=>({...y,[r]:u}))};return!o||o.type!=="provider"?null:e.jsx("div",{className:"bg-white rounded-lg p-1",children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"amount",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"💰"}),e.jsx("span",{children:"Prix proposé (€)"})]}),e.jsx(k,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Ex: 2500",value:d.amount,onChange:r=>i("amount",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-colors",required:!0,"data-testid":"input-bid-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"timeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"⏱️"}),e.jsx("span",{children:"Délai de livraison"})]}),e.jsx(k,{id:"timeline",type:"text",placeholder:"Ex: 4 semaines",value:d.timeline,onChange:r=>i("timeline",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-colors",required:!0,"data-testid":"input-bid-timeline"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"proposal",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"📝"}),e.jsx("span",{children:"Décrivez votre proposition"})]}),e.jsx(V,{id:"proposal",placeholder:"Expliquez votre approche, votre expérience pertinente et ce que vous allez concrètement livrer pour cette mission...",value:d.proposal,onChange:r=>i("proposal",r.target.value),className:"min-h-[120px] rounded-lg border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-100 resize-none transition-colors",required:!0,"data-testid":"textarea-bid-proposal"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(h,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-lg text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]",disabled:c.isPending||v.isSubmitting,"data-testid":"button-submit-bid",children:c.isPending||v.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚀"}),e.jsx("span",{children:"Envoyer ma candidature"})]})})})]})})}function Qe({missionId:x,onSuccess:g}){const{user:o}=U(),{toast:d}=te(),N=le(),[c,v]=f.useState(!1),[t,i]=f.useState({amount:"",timeline_days:"",message:""}),[r,u]=f.useState([{name:o?.name||"",role:"Chef d'équipe",experience:"5+ années",isLead:!0,rating:4.5}]),y=()=>{const l={name:"",role:"",experience:"",isLead:!1,rating:4};u([...r,l])},C=(l,p,a)=>{const s=[...r];s[l]={...s[l],[p]:a},u(s)},q=l=>{if(l===0)return;const p=r.filter((a,s)=>s!==l);u(p)},_=async l=>{if(l.preventDefault(),!o){d({title:"Erreur",description:"Vous devez être connecté pour soumettre une offre",variant:"destructive"});return}if(!t.amount||!t.timeline_days||!t.message){d({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}if(r.length<2){d({title:"Erreur",description:"Une équipe doit avoir au moins 2 membres",variant:"destructive"});return}if(r.filter(a=>!a.name||!a.role||!a.experience).length>0){d({title:"Erreur",description:"Veuillez compléter les informations de tous les membres de l'équipe",variant:"destructive"});return}v(!0);try{const a={members:r,total_budget:parseInt(t.amount),estimated_timeline:parseInt(t.timeline_days),description:t.message},m=await(await de("POST","/api/bids",{mission_id:parseInt(x),amount:t.amount,timeline_days:parseInt(t.timeline_days),message:t.message,bid_type:"team",team_composition:a,team_lead_id:o.id})).json();d({title:"✅ Candidature d'équipe soumise !",description:`Votre équipe de ${r.length} membres a été proposée avec succès.`}),N.invalidateQueries({queryKey:["mission-detail",x]}),N.invalidateQueries({queryKey:["missions"]}),g()}catch(a){console.error("Erreur soumission candidature équipe:",a),d({title:"Erreur",description:a instanceof Error?a.message:"Impossible de soumettre la candidature",variant:"destructive"})}finally{v(!1)}};return!o||o.type!=="provider"?null:e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Candidature d'équipe"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Présentez votre équipe pré-constituée pour cette mission"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Composition de l'équipe"]}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:y,"data-testid":"button-add-member",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((l,p)=>e.jsxs(z,{className:`${l.isLead?"ring-2 ring-purple-200 bg-purple-50":"bg-gray-50"}`,children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{className:"text-sm flex items-center gap-2",children:l.isLead?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 text-purple-600"}),"Chef d'équipe"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4"}),"Membre ",p]})}),!l.isLead&&e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(p),"data-testid":`button-remove-member-${p}`,children:e.jsx(ee,{className:"w-4 h-4"})})]})}),e.jsxs(D,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Nom complet *"}),e.jsx(k,{placeholder:"Nom du membre",value:l.name,onChange:a=>C(p,"name",a.target.value),disabled:l.isLead,"data-testid":`input-member-name-${p}`})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Rôle/Spécialité *"}),e.jsx(k,{placeholder:"Ex: Développeur Frontend",value:l.role,onChange:a=>C(p,"role",a.target.value),"data-testid":`input-member-role-${p}`})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Expérience *"}),e.jsxs(X,{value:l.experience,onValueChange:a=>C(p,"experience",a),children:[e.jsx(Z,{"data-testid":`select-member-experience-${p}`,children:e.jsx(W,{placeholder:"Niveau d'expérience"})}),e.jsxs(J,{children:[e.jsx(S,{value:"1-2 années",children:"1-2 années"}),e.jsx(S,{value:"3-5 années",children:"3-5 années"}),e.jsx(S,{value:"5+ années",children:"5+ années"}),e.jsx(S,{value:"10+ années",children:"10+ années"})]})]})]})]})]},p))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"team-amount",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Prix total équipe (€) *"]}),e.jsx(k,{id:"team-amount",type:"number",placeholder:"15000",min:"100",value:t.amount,onChange:l=>i(p=>({...p,amount:l.target.value})),"data-testid":"input-team-amount"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Montant global pour toute l'équipe"})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"team-timeline",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Délai (jours) *"]}),e.jsx(k,{id:"team-timeline",type:"number",placeholder:"30",min:"1",value:t.timeline_days,onChange:l=>i(p=>({...p,timeline_days:l.target.value})),"data-testid":"input-team-timeline"})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"team-message",className:"text-base font-medium",children:"Proposition détaillée *"}),e.jsx(V,{id:"team-message",placeholder:"Décrivez comment votre équipe va réaliser cette mission, la répartition des tâches, votre méthodologie...",rows:5,value:t.message,onChange:l=>i(p=>({...p,message:l.target.value})),"data-testid":"textarea-team-message"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Détaillez la stratégie de votre équipe pour cette mission"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Récapitulatif de l'équipe"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres:"}),e.jsxs(w,{variant:"secondary",children:[r.length," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget total:"}),e.jsxs(w,{variant:"secondary",children:[t.amount||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Délai:"}),e.jsxs(w,{variant:"secondary",children:[t.timeline_days||"0"," jours"]})]})]})]}),e.jsx(h,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:c,"data-testid":"button-submit-team-bid",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Soumission en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Soumettre la candidature d'équipe"]})})]})}function He({missionId:x,onSuccess:g}){const{user:o}=U(),{toast:d}=te(),N=le(),[c,v]=f.useState(!1),[t,i]=f.useState({name:"",description:"",estimated_budget:"",estimated_timeline_days:"",max_members:"5",visibility:"public",auto_accept:!0}),[r,u]=f.useState([{title:"",description:"",skills:[],min_experience:1,priority:"medium"}]),y=()=>{const a={title:"",description:"",skills:[],min_experience:1,priority:"medium"};u([...r,a])},C=(a,s,m)=>{const b=[...r];b[a]={...b[a],[s]:m},u(b)},q=a=>{if(r.length<=1)return;const s=r.filter((m,b)=>b!==a);u(s)},_=(a,s)=>{if(!s.trim())return;const m=[...r],b=m[a].skills;b.includes(s.trim())||(m[a].skills=[...b,s.trim()],u(m))},l=(a,s)=>{const m=[...r];m[a].skills=m[a].skills.filter((b,re)=>re!==s),u(m)},p=async a=>{if(a.preventDefault(),!o){d({title:"Erreur",description:"Vous devez être connecté pour créer une équipe ouverte",variant:"destructive"});return}if(!t.name||!t.description||!t.estimated_budget||!t.estimated_timeline_days){d({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}const s=r.filter(m=>m.title.trim());if(s.length===0){d({title:"Erreur",description:"Veuillez définir au moins un rôle recherché",variant:"destructive"});return}v(!0);try{const b=await(await de("POST","/api/open-teams",{mission_id:parseInt(x),name:t.name,description:t.description,estimated_budget:parseInt(t.estimated_budget)*100,estimated_timeline_days:parseInt(t.estimated_timeline_days),max_members:parseInt(t.max_members),visibility:t.visibility,auto_accept:t.auto_accept,required_roles:s,members:[{user_id:o.id,name:o.name,role:"Initiateur",experience_years:5,rating:4.5,joined_at:new Date().toISOString()}]})).json();d({title:"🚀 Équipe ouverte créée !",description:`${t.name} est maintenant ouverte au recrutement.`}),N.invalidateQueries({queryKey:["mission-detail",x]}),N.invalidateQueries({queryKey:["open-teams"]}),g()}catch(m){console.error("Erreur création équipe ouverte:",m),d({title:"Erreur",description:m instanceof Error?m.message:"Impossible de créer l'équipe ouverte",variant:"destructive"})}finally{v(!1)}};return!o||o.type!=="provider"?null:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Créer une équipe ouverte"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Initiez une équipe où d'autres prestataires peuvent vous rejoindre"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"team-name",className:"text-base font-medium",children:"Nom de l'équipe *"}),e.jsx(k,{id:"team-name",placeholder:"Ex: Équipe Développement Web Pro",value:t.name,onChange:a=>i(s=>({...s,name:a.target.value})),"data-testid":"input-team-name"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"team-description",className:"text-base font-medium",children:"Description de l'équipe *"}),e.jsx(V,{id:"team-description",placeholder:"Décrivez votre approche, votre vision pour cette mission...",rows:3,value:t.description,onChange:a=>i(s=>({...s,description:a.target.value})),"data-testid":"textarea-team-description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"estimated-budget",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Budget estimé (€) *"]}),e.jsx(k,{id:"estimated-budget",type:"number",placeholder:"10000",min:"100",value:t.estimated_budget,onChange:a=>i(s=>({...s,estimated_budget:a.target.value})),"data-testid":"input-estimated-budget"})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"estimated-timeline",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Délai estimé (jours) *"]}),e.jsx(k,{id:"estimated-timeline",type:"number",placeholder:"45",min:"1",value:t.estimated_timeline_days,onChange:a=>i(s=>({...s,estimated_timeline_days:a.target.value})),"data-testid":"input-estimated-timeline"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(j,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Rôles recherchés"]}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:y,"data-testid":"button-add-role",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((a,s)=>e.jsxs(z,{className:"bg-orange-50 border-orange-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{className:"text-sm",children:["Rôle ",s+1]}),r.length>1&&e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(s),"data-testid":`button-remove-role-${s}`,children:e.jsx(ee,{className:"w-4 h-4"})})]})}),e.jsxs(D,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Titre du poste *"}),e.jsx(k,{placeholder:"Ex: Développeur React",value:a.title,onChange:m=>C(s,"title",m.target.value),"data-testid":`input-role-title-${s}`})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Priorité"}),e.jsxs(X,{value:a.priority,onValueChange:m=>C(s,"priority",m),children:[e.jsx(Z,{"data-testid":`select-role-priority-${s}`,children:e.jsx(W,{})}),e.jsxs(J,{children:[e.jsx(S,{value:"high",children:"Haute"}),e.jsx(S,{value:"medium",children:"Moyenne"}),e.jsx(S,{value:"low",children:"Basse"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Description du rôle"}),e.jsx(V,{placeholder:"Décrivez les responsabilités et attentes...",rows:2,value:a.description,onChange:m=>C(s,"description",m.target.value),"data-testid":`textarea-role-description-${s}`})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Compétences requises"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.skills.map((m,b)=>e.jsxs(w,{variant:"secondary",className:"flex items-center gap-1",children:[m,e.jsx(ee,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>l(s,b)})]},b))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{placeholder:"Ajouter une compétence...",onKeyPress:m=>{m.key==="Enter"&&(m.preventDefault(),_(s,m.currentTarget.value),m.currentTarget.value="")},"data-testid":`input-role-skill-${s}`}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:m=>{const b=m.currentTarget.parentNode?.querySelector("input");b&&(_(s,b.value),b.value="")},children:e.jsx(ie,{className:"w-4 h-4"})})]})]})]})]},s))})]}),e.jsxs(z,{className:"bg-gray-50",children:[e.jsx(E,{children:e.jsxs(F,{className:"text-sm flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Paramètres de l'équipe"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Nombre max de membres"}),e.jsxs(X,{value:t.max_members,onValueChange:a=>i(s=>({...s,max_members:a})),children:[e.jsx(Z,{"data-testid":"select-max-members",children:e.jsx(W,{})}),e.jsxs(J,{children:[e.jsx(S,{value:"3",children:"3 membres"}),e.jsx(S,{value:"5",children:"5 membres"}),e.jsx(S,{value:"7",children:"7 membres"}),e.jsx(S,{value:"10",children:"10 membres"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm",children:"Visibilité"}),e.jsxs(X,{value:t.visibility,onValueChange:a=>i(s=>({...s,visibility:a})),children:[e.jsx(Z,{"data-testid":"select-visibility",children:e.jsx(W,{})}),e.jsxs(J,{children:[e.jsx(S,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Publique"]})}),e.jsx(S,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Privée"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{id:"auto-accept",checked:t.auto_accept,onCheckedChange:a=>i(s=>({...s,auto_accept:a})),"data-testid":"switch-auto-accept"}),e.jsx(j,{htmlFor:"auto-accept",className:"text-sm",children:"Accepter automatiquement les candidatures"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Récapitulatif de l'équipe ouverte"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Nom:"}),e.jsx(w,{variant:"secondary",children:t.name||"Non défini"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget estimé:"}),e.jsxs(w,{variant:"secondary",children:[t.estimated_budget||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres max:"}),e.jsxs(w,{variant:"secondary",children:[t.max_members," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Rôles définis:"}),e.jsxs(w,{variant:"secondary",children:[r.filter(a=>a.title).length," rôles"]})]})]})]}),e.jsx(h,{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-700",disabled:c,"data-testid":"button-submit-open-team",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Création en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Créer l'équipe ouverte"]})})]})}function Ge({mission:x,user:g,sortedBids:o,showAIAnalyzer:d,setShowAIAnalyzer:N,showBidForm:c,setShowBidForm:v}){const[t,i]=f.useState("individual"),[r,u]=f.useState(!1),[y,C]=f.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 md:p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:"Candidater à cette mission"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Choisissez votre mode de candidature"})]})]}),e.jsxs(ge,{value:t,onValueChange:q=>i(q),className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(P,{value:"individual",className:"text-xs md:text-sm data-[testid=tab-individual]","data-testid":"tab-individual",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),"Solo"]}),e.jsxs(P,{value:"team",className:"text-xs md:text-sm","data-testid":"tab-team",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Équipe"]}),e.jsxs(P,{value:"open_team",className:"text-xs md:text-sm","data-testid":"tab-open-team",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Équipe Ouverte"]})]}),e.jsx(A,{value:"individual",className:"space-y-4 mt-0",children:e.jsxs(z,{className:"bg-blue-50 border-blue-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs(F,{className:"text-sm flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Candidature individuelle"]})}),e.jsxs(D,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez seul à cette mission avec votre expertise."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(h,{onClick:()=>N(!d),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-sm",size:"default","data-testid":"button-ai-analyzer",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Analyser avec l'IA"]}),e.jsxs(h,{onClick:()=>v(!c),className:"w-full bg-green-600 hover:bg-green-700 text-sm",size:"default","data-testid":"button-submit-individual",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),c?"Masquer le formulaire":"Soumettre une offre"]})]}),d&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Pe,{missionTitle:x.title,missionDescription:x.description,missionBudget:parseFloat(x.budget||"0"),missionCategory:x.category,currentBid:{price:0,timeline:"",proposal:""},providerProfile:{rating:4.5,completedProjects:25,skills:["React","Node.js","TypeScript"],portfolio:[]},competitorBids:o,onOptimizedBidGenerated:q=>{v(!0)}})}),c&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ke,{missionId:x.id,onSuccess:()=>{v(!1),N(!1)}})})]})]})}),e.jsx(A,{value:"team",className:"space-y-4 mt-0",children:e.jsxs(z,{className:"bg-purple-50 border-purple-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs(F,{className:"text-sm flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Candidature d'équipe"]})}),e.jsxs(D,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez avec une équipe pré-constituée que vous dirigez."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg border",children:[e.jsx(ae,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vous êtes le chef d'équipe"})]}),e.jsxs(h,{onClick:()=>u(!r),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",size:"default","data-testid":"button-submit-team",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),r?"Masquer le formulaire":"Candidater en équipe"]})]}),r&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Qe,{missionId:x.id,onSuccess:()=>{u(!1)}})})]})]})}),e.jsx(A,{value:"open_team",className:"space-y-4 mt-0",children:e.jsxs(z,{className:"bg-orange-50 border-orange-200",children:[e.jsx(E,{className:"pb-3",children:e.jsxs(F,{className:"text-sm flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Équipe ouverte"]})}),e.jsxs(D,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Créez une équipe ouverte où d'autres prestataires peuvent vous rejoindre."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(ye,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Recrutement ouvert"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Ue,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Collaboration"})]})]}),e.jsxs(h,{onClick:()=>C(!y),className:"w-full bg-orange-600 hover:bg-orange-700 text-sm",size:"default","data-testid":"button-submit-open-team",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),y?"Masquer le formulaire":"Créer une équipe ouverte"]})]}),y&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(He,{missionId:x.id,onSuccess:()=>{C(!1)}})})]})]})})]})]})}function Xe({providerId:x,providerName:g,isOpen:o,onClose:d}){const{toast:N}=te(),{data:c,isLoading:v}=je({queryKey:["/api/providers",x,"profile"],enabled:!!x&&o}),t=i=>Array.from({length:5},(r,u)=>e.jsx(ae,{className:`w-4 h-4 ${u<i?"text-yellow-400 fill-current":"text-gray-300"}`},u));return!o||!x?null:e.jsx($,{open:o,onOpenChange:d,children:e.jsxs(I,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ce,{children:e.jsx(me,{asChild:!0,children:e.jsx(ke,{children:"Profil du prestataire"})})}),e.jsx("div",{className:"p-6"}),v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):c?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:c.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),c.location||"Localisation non spécifiée"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Membre depuis ",G(c.joinedAt)]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:c.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end mb-2",children:[e.jsx("div",{className:"flex items-center mr-2",children:t(Math.round(parseFloat(c.rating)))}),e.jsx("span",{className:"text-xl font-bold",children:c.rating})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[c.totalProjects," projets réalisés"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.skills.map((i,r)=>e.jsx(w,{variant:"secondary",children:i},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs(h,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{window.location.href=`/messages?contact=${x}&name=${encodeURIComponent(g)}`},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(h,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",onClick:()=>{N({title:"Contacter le prestataire",description:`Appelez ${g} pour discuter du projet`})},children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Appeler"]}),e.jsxs(h,{className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white",onClick:()=>{N({title:"Réservation de créneau",description:`Fonctionnalité de réservation avec ${g} en cours de développement`})},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Réserver un créneau"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ne,{className:"w-5 h-5 mr-2"}),"Réalisations récentes"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:c.portfolio.slice(0,4).map(i=>e.jsx(z,{children:e.jsxs(D,{className:"p-4",children:[i.images.length>0&&e.jsx("img",{src:i.images[0],alt:i.title,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:i.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(w,{variant:"outline",children:i.category}),e.jsx("span",{className:"text-xs text-gray-500",children:G(i.completedAt)})]})]})},i.id))}),c.portfolio.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune réalisation disponible pour le moment"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Disponibilités"]}),e.jsx(z,{children:e.jsx(D,{className:"p-4",children:e.jsx(Ae,{readOnly:!0,initialAvailability:c.availability||[]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(be,{className:"w-5 h-5 mr-2"}),"Avis clients (",c.evaluations.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:c.evaluations.map(i=>e.jsx(z,{children:e.jsxs(D,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[t(i.rating),e.jsx("span",{className:"ml-2 font-medium",children:i.clientName})]}),e.jsx("span",{className:"text-xs text-gray-500",children:G(i.createdAt)})]})}),e.jsx("p",{className:"text-gray-700 mb-3",children:i.comment}),i.photos&&i.photos.length>0&&e.jsx("div",{className:"flex space-x-2",children:i.photos.slice(0,3).map((r,u)=>e.jsx("img",{src:r,alt:`Photo ${u+1}`,className:"w-16 h-16 object-cover rounded-lg"},u))})]})},i.id))}),c.evaluations.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun avis client pour le moment"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{onClick:d,children:"Fermer"})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Profil non trouvé"})})]})})}function Ze({bidId:x,bidderName:g,isOpen:o,onClose:d}){const{user:N}=U(),{toast:c}=te(),v=le(),[t,i]=f.useState(null),[r,u]=f.useState(""),y=_e({mutationFn:async l=>(await de("POST","/api/bids/respond",l)).json(),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/missions"]});const l=t==="accept"?"acceptée":t==="reject"?"déclinée":"en négociation";c({title:"Réponse envoyée !",description:`Votre réponse (${l}) a été envoyée au prestataire. Il recevra une notification.`}),setTimeout(()=>{alert(`Confirmation : Votre réponse "${l}" a bien été envoyée à ${g}. Un email de confirmation lui a été envoyé.`)},500),d(),i(null),u("")},onError:l=>{c({title:"Erreur",description:l.message||"Une erreur est survenue",variant:"destructive"})}}),C=l=>{if(l.preventDefault(),!t){c({title:"Action requise",description:"Veuillez choisir une action",variant:"destructive"});return}if(t==="negotiate"&&!r.trim()){c({title:"Message requis",description:"Veuillez ajouter un message pour négocier",variant:"destructive"});return}y.mutate({bidId:x,status:t,message:r.trim()||null,clientResponse:t})},q=l=>{switch(l){case"accept":return`Bonjour ${g},

Nous avons le plaisir de vous informer que votre offre a été retenue pour ce projet. Nous allons procéder à la mise en place du contrat.

Cordialement`;case"reject":return`Bonjour ${g},

Nous vous remercions pour votre offre. Malheureusement, nous avons décidé de retenir une autre proposition pour ce projet.

Cordialement`;case"negotiate":return`Bonjour ${g},

Votre offre nous intéresse. Cependant, nous aimerions discuter de certains points :

- 
- 

Êtes-vous ouvert à la négociation ?

Cordialement`}},_=l=>{i(l),u(q(l))};return e.jsx($,{open:o,onOpenChange:d,children:e.jsxs(I,{className:"sm:max-w-2xl bg-white border shadow-lg",children:[e.jsx(ce,{children:e.jsxs(me,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6 text-blue-500"}),"Répondre à l'offre de ",g]})}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choisissez votre réponse :"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>_("accept"),className:`p-4 rounded-xl border-2 transition-all ${t==="accept"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(Te,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"font-semibold",children:"Accepter"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Retenir cette offre"})]}),e.jsxs("button",{type:"button",onClick:()=>_("negotiate"),className:`p-4 rounded-xl border-2 transition-all ${t==="negotiate"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"font-semibold",children:"Négocier"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Demander des ajustements"})]}),e.jsxs("button",{type:"button",onClick:()=>_("reject"),className:`p-4 rounded-xl border-2 transition-all ${t==="reject"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-red-300"}`,children:[e.jsx($e,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"font-semibold",children:"Décliner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ne pas retenir"})]})]})]}),t&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"message",className:"text-sm font-semibold text-gray-800",children:["Message à ",g]}),e.jsx(V,{id:"message",value:r,onChange:l=>u(l.target.value),placeholder:"Votre message...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:d,className:"flex-1",disabled:y.isPending,children:"Annuler"}),e.jsx(h,{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600",disabled:!t||y.isPending,children:y.isPending?"Envoi...":"Envoyer la réponse"})]})]})]})})}function Cs({missionId:x,isOpen:g,onClose:o}){const{user:d}=U(),[N,c]=f.useState("overview"),[v,t]=f.useState(null),[i,r]=f.useState(""),[u,y]=f.useState(null),[C,q]=f.useState(""),[_,l]=f.useState(!1),[p,a]=f.useState(!1),{data:s,isLoading:m,error:b}=je({queryKey:["mission-detail",x],queryFn:async()=>{if(!x)throw new Error("ID de mission manquant");console.log("🔍 Chargement mission ID:",x);try{const n=await fetch(`/api/missions/${x}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){const K=await n.text();throw console.error("❌ Erreur API mission:",n.status,K),new Error(`Erreur ${n.status}: ${n.statusText}`)}const R=await n.json();return console.log("✅ Mission chargée:",R?.title||"Sans titre"),R}catch(n){throw console.error("❌ Erreur réseau mission:",n),n}},enabled:!!x&&g,retry:1,retryDelay:2e3,staleTime:3e4}),re=n=>{const R=typeof n=="string"?parseFloat(n):n;return Array.from({length:5},(K,Q)=>e.jsx(ae,{className:`w-3 h-3 ${Q<Math.floor(R)?"text-yellow-400 fill-current":"text-gray-300"}`},Q))};if(m)return e.jsx($,{open:g,onOpenChange:o,children:e.jsx(I,{className:"w-[95vw] max-w-lg mx-auto p-0 gap-0 bg-white",children:e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-500 border-t-transparent"}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Chargement..."})]})})})});if(b||!s)return e.jsx($,{open:g,onOpenChange:o,children:e.jsx(I,{className:"w-[95vw] max-w-lg mx-auto p-6 gap-4 bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-50 rounded-full flex items-center justify-center",children:e.jsx(Ie,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Erreur de chargement"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:b instanceof Error?b.message:"Mission introuvable"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(h,{onClick:()=>window.location.reload(),variant:"outline",size:"sm",children:"Recharger"}),e.jsx(h,{onClick:o,size:"sm",children:"Fermer"})]})]})})});const xe=Me(s.category),T=s.bids?[...s.bids].sort((n,R)=>parseFloat(n.amount)-parseFloat(R.amount)):[],ue=s.teamRequirements&&s.teamRequirements.length>0;return e.jsxs($,{open:g,onOpenChange:o,children:[e.jsxs(I,{className:"w-[95vw] max-h-[90vh] max-w-4xl p-0 gap-0 bg-gray-50 rounded-xl flex flex-col",children:[e.jsxs(ce,{className:"sr-only",children:[e.jsx(me,{children:s.title}),e.jsx(Re,{children:"Détails de la mission"})]}),e.jsxs("div",{className:"flex flex-col min-h-0 max-h-[90vh]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-blue-700 to-purple-600 text-white relative flex-shrink-0 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-6",children:[e.jsx(h,{onClick:o,size:"sm",variant:"ghost",className:"text-white hover:bg-white/20 p-2 rounded-full md:hidden",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 md:flex-none min-w-0",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-bold leading-tight pr-2 md:pr-0 truncate",children:s.title}),e.jsxs("p",{className:"text-blue-100 text-sm md:text-base mt-1 opacity-90 truncate",children:["Par ",s.clientName," • ",H(s.budget||"0")]})]}),e.jsx(h,{onClick:o,size:"sm",variant:"ghost",className:"text-white hover:bg-white/20 p-1.5 rounded-full","aria-label":"Fermer la modal",children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"px-3 pb-4 md:px-6 md:pb-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-6 text-sm text-blue-100 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"w-3 h-3"}),e.jsxs("span",{children:[T.length," candidature",T.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:G(s.createdAt||new Date().toISOString())}),e.jsx("span",{className:"sm:hidden",children:"Créé"})]}),xe&&e.jsx(w,{className:"bg-white/25 text-white border-none text-sm px-3 py-1 rounded-full font-medium",children:xe.name})]})})]}),e.jsx("div",{className:"bg-white border-b shadow-sm flex-shrink-0",children:e.jsxs(ge,{value:N,onValueChange:c,className:"w-full",children:[e.jsx(ve,{className:"w-full h-12 md:h-14 bg-transparent rounded-none border-none p-0",children:e.jsxs("div",{className:"flex w-full",children:[e.jsxs(P,{value:"overview",className:"flex-1 h-12 md:h-14 text-sm font-semibold data-[state=active]:bg-transparent data-[state=active]:border-b-3 data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 rounded-none px-3 transition-all duration-200",children:[e.jsx(ne,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Aperçu"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]}),e.jsxs(P,{value:"bids",className:"flex-1 h-12 md:h-14 text-sm font-semibold data-[state=active]:bg-transparent data-[state=active]:border-b-3 data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 rounded-none px-3 transition-all duration-200",children:[e.jsx(M,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsxs("span",{className:"hidden sm:inline",children:["Offres (",T.length,")"]}),e.jsxs("span",{className:"sm:hidden",children:["(",T.length,")"]})]}),ue&&e.jsxs(P,{value:"team",className:"flex-1 h-12 md:h-14 text-sm font-semibold data-[state=active]:bg-transparent data-[state=active]:border-b-3 data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 rounded-none px-3 transition-all duration-200",children:[e.jsx(pe,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Équipe"}),e.jsx("span",{className:"sm:hidden",children:"Team"})]})]})}),e.jsxs("div",{className:"flex-1 min-h-0",children:[e.jsx(A,{value:"overview",className:"m-0 data-[state=active]:flex data-[state=active]:flex-col",children:e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300",children:e.jsxs("div",{className:"p-3 md:p-6 space-y-3 md:space-y-4 pb-6 md:pb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 shadow-sm border",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3 text-sm md:text-base",children:"Description du projet"}),e.jsx("p",{className:"text-gray-700 leading-relaxed text-sm md:text-base",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 md:p-4 border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 md:mb-2",children:[e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900 text-xs md:text-sm",children:"Budget"})]}),e.jsx("div",{className:"text-lg md:text-2xl font-bold text-green-600",children:H(s.budget||"0")})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 md:p-4 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 md:mb-2",children:[e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900 text-xs md:text-sm",children:"Lieu"})]}),e.jsx("div",{className:"text-blue-600 font-medium text-xs md:text-base truncate",children:s.location||"Non spécifié"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 md:p-4 border border-purple-100 col-span-2 md:col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 md:mb-2",children:[e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900 text-xs md:text-sm",children:"Intérêt"})]}),e.jsxs("div",{className:"text-purple-600 font-medium text-xs md:text-base",children:[T.length," candidature",T.length!==1?"s":""]})]})]}),d&&d.type==="provider"&&s.clientName!==d.name&&e.jsx(Ge,{mission:s,user:d,sortedBids:T,showAIAnalyzer:p,setShowAIAnalyzer:a,showBidForm:_,setShowBidForm:l}),d&&d.type==="provider"&&s.clientName===d.name&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(he,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-blue-700 font-medium text-sm",children:"Ceci est votre mission"})]})})]})})}),e.jsx(A,{value:"bids",className:"m-0 data-[state=active]:flex data-[state=active]:flex-col",children:e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300",children:e.jsx("div",{className:"p-3 md:p-6 space-y-3 md:space-y-4 pb-6 md:pb-8",children:T.length===0?e.jsxs("div",{className:"bg-white rounded-lg p-8 md:p-12 text-center shadow-sm border",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune candidature"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Les prestataires peuvent encore postuler"})]}):e.jsx("div",{className:"space-y-3",children:T.map((n,R)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 shadow-sm border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:n.providerName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 transition-colors text-sm md:text-base",onClick:()=>{t(n.providerId),r(n.providerName)},children:n.providerName}),n.bid_type==="team"&&e.jsxs(w,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 border-purple-200",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Équipe"]}),n.bid_type==="open_team"&&e.jsxs(w,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-green-100 text-green-700 border-green-200",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Équipe Ouverte"]}),(!n.bid_type||n.bid_type==="individual")&&e.jsxs(w,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 border-blue-200",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Individuel"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center",children:re(n.rating||"5.0")}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:[parseFloat(n.rating||"5.0").toFixed(1),"/5"]}),R===0&&T.length>1&&e.jsx(w,{className:"bg-green-100 text-green-700 text-xs ml-2",children:"Meilleure offre"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-green-600",children:H(n.price)}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center justify-end mt-1",children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),n.timeline]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 md:p-4 mb-4 border-l-4 border-blue-400",children:e.jsx("p",{className:"text-gray-700 text-sm md:text-base leading-relaxed whitespace-pre-line",children:n.proposal})}),d&&s.userName===d.name&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs(h,{onClick:()=>{y(n.id),q(n.providerName)},variant:"outline",size:"sm",className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),"Répondre"]}),e.jsxs(h,{size:"sm",className:"bg-green-500 hover:bg-green-600 text-white flex items-center justify-center gap-2 text-sm",children:[e.jsx(he,{className:"w-4 h-4"}),"Accepter"]})]})]},n.id))})})})}),ue&&e.jsx(A,{value:"team",className:"m-0 data-[state=active]:flex data-[state=active]:flex-col",children:e.jsxs("div",{className:"overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300",children:[e.jsx("div",{className:"p-3 md:p-6 space-y-3 md:space-y-4 pb-6 md:pb-8"}),e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 shadow-sm border",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2 text-sm md:text-base",children:[e.jsx(pe,{className:"w-5 h-5"}),"Composition de l'équipe"]}),e.jsx("div",{className:"space-y-3",children:s.teamRequirements?.map((n,R)=>e.jsxs("div",{className:"border-l-4 border-l-blue-500 bg-blue-50/50 rounded-r-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:n.role}),e.jsx("p",{className:"text-gray-600 text-xs md:text-sm",children:n.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm md:text-base font-bold text-green-600",children:H(n.budget||"0")}),e.jsxs(w,{variant:"outline",className:"text-xs",children:[n.quantity," personne",n.quantity>1?"s":""]})]})]}),n.skills&&n.skills.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-xs mb-2",children:"Compétences :"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.skills.map((K,Q)=>e.jsx(w,{variant:"secondary",className:"text-xs",children:K},Q))})]})]},R))})]})]})})]})]})})]})]}),e.jsx(Xe,{providerId:v,providerName:i,isOpen:!!v,onClose:()=>{t(null),r("")}}),e.jsx(Ze,{bidId:u,bidderName:C,isOpen:!!u,onClose:()=>{y(null),q("")}})]})}export{Cs as M};
