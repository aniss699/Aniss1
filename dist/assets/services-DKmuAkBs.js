function l(e){const t=e.budget_value_cents?Math.round(e.budget_value_cents/100):e.budget?typeof e.budget=="string"?parseInt(e.budget,10):e.budget:0;return{id:e.id,title:e.title||"",description:e.description||"",category:e.category||"",budget:t,budgetDisplay:`${t.toLocaleString()}€`,location:e.location||e.location_data?.city,clientName:e.clientName||e.client_name||`Client #${e.user_id||e.client_id}`,createdAt:e.createdAt||e.created_at||new Date().toISOString(),status:e.status||"draft",urgency:e.urgency,bids:e.bids?e.bids.map(d):[],teamRequirements:e.teamRequirements||e.team_requirements}}function d(e){const t=e.amount?typeof e.amount=="string"?parseFloat(e.amount):e.amount:e.price?parseFloat(e.price):0;return{id:e.id,providerId:e.providerId||e.provider_id,providerName:e.providerName||e.provider_name,amount:t,price:`${t}€`,message:e.message,bid_type:e.bid_type,timeline_days:e.timeline_days,status:e.status}}function c(e){return{id:e.id,title:e.title||"",description:e.description||e.content||"",category:e.category||"",budgetMin:e.budgetMin||e.budget_min,budgetMax:e.budgetMax||e.budget_max,deadline:e.deadline?new Date(e.deadline):void 0,city:e.city||e.location,userId:e.userId||e.user_id,tags:e.tags||[],sponsored:e.sponsored||!1,qualityScore:e.qualityScore||e.quality_score||.8}}const i=e=>new Promise(t=>setTimeout(t,e)),g={async createFlashDeal(e){return await i(400),console.log("Creating flash deal:",e),{success:!0,id:`flash_${Date.now()}`}},async createReverseSubscription(e){return await i(500),console.log("Creating reverse subscription:",e),{success:!0,id:`sub_${Date.now()}`}},async createGroupRequest(e){return await i(350),console.log("Creating group request:",e),{success:!0,id:`group_${Date.now()}`}},async getGroupInterest(e,t){return await i(300),{count:Math.floor(Math.random()*15)+1}},async aiDraftBrief(e){return await i(600),console.log("AI drafting brief for:",e),{scope:`Analyse du besoin : ${e.substring(0,100)}...`,deliverables:["Cahier des charges détaillé","Maquettes fonctionnelles","Planning de réalisation","Estimation budgétaire précise"],risks:["Délais serrés potentiels","Complexité technique à évaluer","Besoin de clarifications complémentaires"],checklist:["Validation du périmètre fonctionnel","Définition des critères d'acceptation","Planification des points de contrôle","Mise en place des outils de suivi"]}},async createIaHumanJob(e){return await i(400),console.log("Creating IA+Human job with brief:",e),{success:!0,id:`ia_${Date.now()}`}},async getLiveSlots(e={}){await i(450),console.log("Fetching live slots with filters:",e);const t=["Alice M.","Thomas B.","Sophie L.","Marc D.","Emma P."],o=["Développement","Design","Marketing","Conseil","Formation"];return Array.from({length:8},(s,r)=>({id:`slot_${r}_${Date.now()}`,providerName:t[Math.floor(Math.random()*t.length)],rating:4+Math.random(),slot:new Date(Date.now()+Math.random()*7*24*60*60*1e3).toISOString(),duration:[30,60,90,120][Math.floor(Math.random()*4)],pricePerHour:Math.floor(Math.random()*80)+40,distance:Math.floor(Math.random()*20)+1,tags:o.slice(0,Math.floor(Math.random()*3)+1)}))},async reserveSlot(e){return await i(300),console.log("Reserving slot:",e),{success:!0}}},p={async getMissions(){const e=await fetch("/api/missions",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!e.ok){const n=await e.text();throw console.error("❌ Erreur API missions:",e.status,n),new Error(`Erreur ${e.status}: ${e.statusText}`)}const t=await e.json();let o=[],s={total:0};t.missions&&Array.isArray(t.missions)?(o=t.missions,s=t.metadata||{total:t.missions.length}):Array.isArray(t)&&(o=t,s={total:t.length});const r=o.map(n=>l(n));return console.log("✅ Missions normalisées avec mappers:",r.length),{missions:r,metadata:s}},async getUserMissions(e){const t=await fetch(`/api/missions/users/${e}/missions`);if(!t.ok){const r=await t.text();throw console.error("❌ Erreur API missions utilisateur:",t.status,r),new Error(`Erreur ${t.status}: ${r}`)}const s=(await t.json()).map(r=>l(r));return console.log("✅ Missions utilisateur normalisées:",s.length),s},async getUserBids(e){const t=await fetch(`/api/missions/users/${e}/bids`);if(!t.ok)throw new Error("Failed to fetch user bids");const s=(await t.json()).map(r=>d(r));return console.log("✅ Bids utilisateur normalisés:",s.length),s},async getMissionById(e){const t=await fetch(`/api/missions/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){const r=await t.text();throw console.error("❌ Erreur API mission:",t.status,r),new Error(`Erreur ${t.status}: ${t.statusText}`)}const o=await t.json(),s=l(o);return console.log("✅ Mission normalisée:",s.title),s},async getFeed(e,t=10){const o=new URLSearchParams({limit:t.toString()});e&&o.append("cursor",e);const s=await fetch(`/api/feed?${o}`);if(!s.ok)throw new Error("Erreur lors du chargement du feed");const a=((await s.json()).items||[]).map(u=>c(u));return console.log("✅ Feed normalisé:",a.length,"annonces"),{items:a,hasMore:a.length===t}},async getFavorites(e){const t=await fetch(`/api/favorites?user_id=${e}`);if(!t.ok)throw new Error("Erreur lors du chargement des favoris");const r=((await t.json()).favorites||[]).map(n=>c(n));return console.log("✅ Favoris normalisés:",r.length),r}};export{p as d,g as s};
