import{r as N,j as e}from"./ui-BcXBiFQq.js";import{u as be}from"./useQuery-DKqfzDJ5.js";import{j as te,e as U,k as Se,l as qe,v as _e,L as b,I as _,B as j,g as ae,f as ce,U as D,m as oe,P as de,C as M,a as $,i as E,n as ee,X as se,b as z,o as me,Z as Te,D as B,q as I,r as xe,s as ue,V as Re,h as De,d as Me,t as ze,T as ge}from"./index-CRSWtPlv.js";import{a as X,g as $e,f as G}from"./categories-Ci5EyH-Y.js";import{T as ve,a as fe,b as ne,c as F}from"./tabs-CbBan9ST.js";import{T as V}from"./textarea-C-Ma2iHJ.js";import{S as Z,a as W,b as J,c as Y,d as k}from"./select-ndiqlwc5.js";import{B as w}from"./badge-D532lkyf.js";import{S as re}from"./star-DsgTV-kW.js";import{E as pe}from"./euro-C8MT-VaQ.js";import{C as L}from"./calendar-mATNPVKW.js";import{S as Ee}from"./switch-Dynwhxgd.js";import{S as Fe}from"./settings-DzyRxAJW.js";import{G as Pe}from"./globe-Di231Zqh.js";import{L as Ae}from"./lock-y0VNE8wZ.js";import{S as Be}from"./smart-bid-analyzer-C2N46KIA.js";import{A as Ne}from"./award-BxVemJ_Y.js";import{M as O}from"./message-circle-BeL5T_-k.js";import{A as Ie}from"./availability-calendar-DE-HpX3F.js";import{M as ye}from"./map-pin-Y-laH7Hd.js";import{P as Ve}from"./phone-Zq2Jv7TR.js";import{C as we}from"./clock-CzDLVM0U.js";import{C as Le}from"./circle-x-CdJmPQgN.js";import{C as Oe}from"./circle-alert-MiBKHG8I.js";import{C as Ue}from"./chevron-left-DmBmPxt6.js";import{E as Ke}from"./eye-CGxbelhk.js";import{T as Qe}from"./trending-up-6PmzfaOU.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=te("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=te("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=te("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=te("UsersRound",[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]]);function Ge({missionId:p,onSuccess:v}){const{user:x}=U(),[d,u]=N.useState({amount:"",timeline:"",proposal:""}),o=Se("/api/bids",{successMessage:"🚀 Offre envoyée avec succès !",errorContext:"Soumission d'offre",invalidateQueries:[["/api/missions",p],["/api/missions"],["/api/users",x?.id,"bids"]],onSuccess:()=>{u({amount:"",timeline:"",proposal:""}),v()}}),f=qe({onSubmit:async r=>{o.mutate(r)},validateBeforeSubmit:_e.validateBid}),s=r=>{if(r.preventDefault(),!x){f.handleError(new Error("Vous devez être connecté pour postuler"),"Authentification requise");return}f.handleSubmit({...d,missionId:p,providerId:x.id,providerName:x.name,amount:d.amount,rating:x.rating||"5.0"})},i=(r,h)=>{u(y=>({...y,[r]:h}))};return!x||x.type!=="provider"?null:e.jsx("div",{className:"bg-white rounded-lg p-1",children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"amount",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"💰"}),e.jsx("span",{children:"Prix proposé (€)"})]}),e.jsx(_,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"Ex: 2500",value:d.amount,onChange:r=>i("amount",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-colors",required:!0,"data-testid":"input-bid-price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"timeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"⏱️"}),e.jsx("span",{children:"Délai de livraison"})]}),e.jsx(_,{id:"timeline",type:"text",placeholder:"Ex: 4 semaines",value:d.timeline,onChange:r=>i("timeline",r.target.value),className:"h-11 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-colors",required:!0,"data-testid":"input-bid-timeline"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"proposal",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"📝"}),e.jsx("span",{children:"Décrivez votre proposition"})]}),e.jsx(V,{id:"proposal",placeholder:"Expliquez votre approche, votre expérience pertinente et ce que vous allez concrètement livrer pour cette mission...",value:d.proposal,onChange:r=>i("proposal",r.target.value),className:"min-h-[120px] rounded-lg border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-100 resize-none transition-colors",required:!0,"data-testid":"textarea-bid-proposal"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(j,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 px-6 rounded-lg text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02]",disabled:o.isPending||f.isSubmitting,"data-testid":"button-submit-bid",children:o.isPending||f.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚀"}),e.jsx("span",{children:"Envoyer ma candidature"})]})})})]})})}function Xe({missionId:p,onSuccess:v}){const{user:x}=U(),{toast:d}=ae(),u=ce(),[o,f]=N.useState(!1),[s,i]=N.useState({amount:"",timeline_days:"",message:""}),[r,h]=N.useState([{name:x?.name||"",role:"Chef d'équipe",experience:"5+ années",isLead:!0,rating:4.5}]),y=()=>{const n={name:"",role:"",experience:"",isLead:!1,rating:4};h([...r,n])},C=(n,g,t)=>{const a=[...r];a[n]={...a[n],[g]:t},h(a)},S=n=>{if(n===0)return;const g=r.filter((t,a)=>a!==n);h(g)},T=async n=>{if(n.preventDefault(),!x){d({title:"Erreur",description:"Vous devez être connecté pour soumettre une offre",variant:"destructive"});return}if(!s.amount||!s.timeline_days||!s.message){d({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}if(r.length<2){d({title:"Erreur",description:"Une équipe doit avoir au moins 2 membres",variant:"destructive"});return}if(r.filter(t=>!t.name||!t.role||!t.experience).length>0){d({title:"Erreur",description:"Veuillez compléter les informations de tous les membres de l'équipe",variant:"destructive"});return}f(!0);try{const t={members:r,total_budget:parseInt(s.amount),estimated_timeline:parseInt(s.timeline_days),description:s.message},m=await(await me("POST","/api/bids",{mission_id:parseInt(p),amount:s.amount,timeline_days:parseInt(s.timeline_days),message:s.message,bid_type:"team",team_composition:t,team_lead_id:x.id})).json();d({title:"✅ Candidature d'équipe soumise !",description:`Votre équipe de ${r.length} membres a été proposée avec succès.`}),u.invalidateQueries({queryKey:["mission-detail",p]}),u.invalidateQueries({queryKey:["missions"]}),v()}catch(t){console.error("Erreur soumission candidature équipe:",t),d({title:"Erreur",description:t instanceof Error?t.message:"Impossible de soumettre la candidature",variant:"destructive"})}finally{f(!1)}};return!x||x.type!=="provider"?null:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Candidature d'équipe"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Présentez votre équipe pré-constituée pour cette mission"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Composition de l'équipe"]}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:y,"data-testid":"button-add-member",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((n,g)=>e.jsxs(M,{className:`${n.isLead?"ring-2 ring-purple-200 bg-purple-50":"bg-gray-50"}`,children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{className:"text-sm flex items-center gap-2",children:n.isLead?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 text-purple-600"}),"Chef d'équipe"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4"}),"Membre ",g]})}),!n.isLead&&e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(g),"data-testid":`button-remove-member-${g}`,children:e.jsx(se,{className:"w-4 h-4"})})]})}),e.jsxs(z,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Nom complet *"}),e.jsx(_,{placeholder:"Nom du membre",value:n.name,onChange:t=>C(g,"name",t.target.value),disabled:n.isLead,"data-testid":`input-member-name-${g}`})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Rôle/Spécialité *"}),e.jsx(_,{placeholder:"Ex: Développeur Frontend",value:n.role,onChange:t=>C(g,"role",t.target.value),"data-testid":`input-member-role-${g}`})]})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Expérience *"}),e.jsxs(Z,{value:n.experience,onValueChange:t=>C(g,"experience",t),children:[e.jsx(W,{"data-testid":`select-member-experience-${g}`,children:e.jsx(J,{placeholder:"Niveau d'expérience"})}),e.jsxs(Y,{children:[e.jsx(k,{value:"1-2 années",children:"1-2 années"}),e.jsx(k,{value:"3-5 années",children:"3-5 années"}),e.jsx(k,{value:"5+ années",children:"5+ années"}),e.jsx(k,{value:"10+ années",children:"10+ années"})]})]})]})]})]},g))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"team-amount",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Prix total équipe (€) *"]}),e.jsx(_,{id:"team-amount",type:"number",placeholder:"15000",min:"100",value:s.amount,onChange:n=>i(g=>({...g,amount:n.target.value})),"data-testid":"input-team-amount"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Montant global pour toute l'équipe"})]}),e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"team-timeline",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Délai (jours) *"]}),e.jsx(_,{id:"team-timeline",type:"number",placeholder:"30",min:"1",value:s.timeline_days,onChange:n=>i(g=>({...g,timeline_days:n.target.value})),"data-testid":"input-team-timeline"})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"team-message",className:"text-base font-medium",children:"Proposition détaillée *"}),e.jsx(V,{id:"team-message",placeholder:"Décrivez comment votre équipe va réaliser cette mission, la répartition des tâches, votre méthodologie...",rows:5,value:s.message,onChange:n=>i(g=>({...g,message:n.target.value})),"data-testid":"textarea-team-message"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Détaillez la stratégie de votre équipe pour cette mission"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Récapitulatif de l'équipe"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres:"}),e.jsxs(w,{variant:"secondary",children:[r.length," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget total:"}),e.jsxs(w,{variant:"secondary",children:[s.amount||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Délai:"}),e.jsxs(w,{variant:"secondary",children:[s.timeline_days||"0"," jours"]})]})]})]}),e.jsx(j,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:o,"data-testid":"button-submit-team-bid",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Soumission en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Soumettre la candidature d'équipe"]})})]})}function Ze({missionId:p,onSuccess:v}){const{user:x}=U(),{toast:d}=ae(),u=ce(),[o,f]=N.useState(!1),[s,i]=N.useState({name:"",description:"",estimated_budget:"",estimated_timeline_days:"",max_members:"5",visibility:"public",auto_accept:!0}),[r,h]=N.useState([{title:"",description:"",skills:[],min_experience:1,priority:"medium"}]),y=()=>{const t={title:"",description:"",skills:[],min_experience:1,priority:"medium"};h([...r,t])},C=(t,a,m)=>{const c=[...r];c[t]={...c[t],[a]:m},h(c)},S=t=>{if(r.length<=1)return;const a=r.filter((m,c)=>c!==t);h(a)},T=(t,a)=>{if(!a.trim())return;const m=[...r],c=m[t].skills;c.includes(a.trim())||(m[t].skills=[...c,a.trim()],h(m))},n=(t,a)=>{const m=[...r];m[t].skills=m[t].skills.filter((c,ie)=>ie!==a),h(m)},g=async t=>{if(t.preventDefault(),!x){d({title:"Erreur",description:"Vous devez être connecté pour créer une équipe ouverte",variant:"destructive"});return}if(!s.name||!s.description||!s.estimated_budget||!s.estimated_timeline_days){d({title:"Erreur",description:"Veuillez remplir tous les champs obligatoires",variant:"destructive"});return}const a=r.filter(m=>m.title.trim());if(a.length===0){d({title:"Erreur",description:"Veuillez définir au moins un rôle recherché",variant:"destructive"});return}f(!0);try{const c=await(await me("POST","/api/open-teams",{mission_id:parseInt(p),name:s.name,description:s.description,estimated_budget:parseInt(s.estimated_budget)*100,estimated_timeline_days:parseInt(s.estimated_timeline_days),max_members:parseInt(s.max_members),visibility:s.visibility,auto_accept:s.auto_accept,required_roles:a,members:[{user_id:x.id,name:x.name,role:"Initiateur",experience_years:5,rating:4.5,joined_at:new Date().toISOString()}]})).json();d({title:"🚀 Équipe ouverte créée !",description:`${s.name} est maintenant ouverte au recrutement.`}),u.invalidateQueries({queryKey:["mission-detail",p]}),u.invalidateQueries({queryKey:["open-teams"]}),v()}catch(m){console.error("Erreur création équipe ouverte:",m),d({title:"Erreur",description:m instanceof Error?m.message:"Impossible de créer l'équipe ouverte",variant:"destructive"})}finally{f(!1)}};return!x||x.type!=="provider"?null:e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Créer une équipe ouverte"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Initiez une équipe où d'autres prestataires peuvent vous rejoindre"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"team-name",className:"text-base font-medium",children:"Nom de l'équipe *"}),e.jsx(_,{id:"team-name",placeholder:"Ex: Équipe Développement Web Pro",value:s.name,onChange:t=>i(a=>({...a,name:t.target.value})),"data-testid":"input-team-name"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"team-description",className:"text-base font-medium",children:"Description de l'équipe *"}),e.jsx(V,{id:"team-description",placeholder:"Décrivez votre approche, votre vision pour cette mission...",rows:3,value:s.description,onChange:t=>i(a=>({...a,description:t.target.value})),"data-testid":"textarea-team-description"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"estimated-budget",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Budget estimé (€) *"]}),e.jsx(_,{id:"estimated-budget",type:"number",placeholder:"10000",min:"100",value:s.estimated_budget,onChange:t=>i(a=>({...a,estimated_budget:t.target.value})),"data-testid":"input-estimated-budget"})]}),e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"estimated-timeline",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Délai estimé (jours) *"]}),e.jsx(_,{id:"estimated-timeline",type:"number",placeholder:"45",min:"1",value:s.estimated_timeline_days,onChange:t=>i(a=>({...a,estimated_timeline_days:t.target.value})),"data-testid":"input-estimated-timeline"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Rôles recherchés"]}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:y,"data-testid":"button-add-role",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]}),e.jsx("div",{className:"space-y-3",children:r.map((t,a)=>e.jsxs(M,{className:"bg-orange-50 border-orange-200",children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"text-sm",children:["Rôle ",a+1]}),r.length>1&&e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(a),"data-testid":`button-remove-role-${a}`,children:e.jsx(se,{className:"w-4 h-4"})})]})}),e.jsxs(z,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Titre du poste *"}),e.jsx(_,{placeholder:"Ex: Développeur React",value:t.title,onChange:m=>C(a,"title",m.target.value),"data-testid":`input-role-title-${a}`})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Priorité"}),e.jsxs(Z,{value:t.priority,onValueChange:m=>C(a,"priority",m),children:[e.jsx(W,{"data-testid":`select-role-priority-${a}`,children:e.jsx(J,{})}),e.jsxs(Y,{children:[e.jsx(k,{value:"high",children:"Haute"}),e.jsx(k,{value:"medium",children:"Moyenne"}),e.jsx(k,{value:"low",children:"Basse"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Description du rôle"}),e.jsx(V,{placeholder:"Décrivez les responsabilités et attentes...",rows:2,value:t.description,onChange:m=>C(a,"description",m.target.value),"data-testid":`textarea-role-description-${a}`})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Compétences requises"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.skills.map((m,c)=>e.jsxs(w,{variant:"secondary",className:"flex items-center gap-1",children:[m,e.jsx(se,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>n(a,c)})]},c))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{placeholder:"Ajouter une compétence...",onKeyPress:m=>{m.key==="Enter"&&(m.preventDefault(),T(a,m.currentTarget.value),m.currentTarget.value="")},"data-testid":`input-role-skill-${a}`}),e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:m=>{const c=m.currentTarget.parentNode?.querySelector("input");c&&(T(a,c.value),c.value="")},children:e.jsx(de,{className:"w-4 h-4"})})]})]})]})]},a))})]}),e.jsxs(M,{className:"bg-gray-50",children:[e.jsx($,{children:e.jsxs(E,{className:"text-sm flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Paramètres de l'équipe"]})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Nombre max de membres"}),e.jsxs(Z,{value:s.max_members,onValueChange:t=>i(a=>({...a,max_members:t})),children:[e.jsx(W,{"data-testid":"select-max-members",children:e.jsx(J,{})}),e.jsxs(Y,{children:[e.jsx(k,{value:"3",children:"3 membres"}),e.jsx(k,{value:"5",children:"5 membres"}),e.jsx(k,{value:"7",children:"7 membres"}),e.jsx(k,{value:"10",children:"10 membres"})]})]})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm",children:"Visibilité"}),e.jsxs(Z,{value:s.visibility,onValueChange:t=>i(a=>({...a,visibility:t})),children:[e.jsx(W,{"data-testid":"select-visibility",children:e.jsx(J,{})}),e.jsxs(Y,{children:[e.jsx(k,{value:"public",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Publique"]})}),e.jsx(k,{value:"private",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Privée"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{id:"auto-accept",checked:s.auto_accept,onCheckedChange:t=>i(a=>({...a,auto_accept:t})),"data-testid":"switch-auto-accept"}),e.jsx(b,{htmlFor:"auto-accept",className:"text-sm",children:"Accepter automatiquement les candidatures"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Récapitulatif de l'équipe ouverte"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Nom:"}),e.jsx(w,{variant:"secondary",children:s.name||"Non défini"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Budget estimé:"}),e.jsxs(w,{variant:"secondary",children:[s.estimated_budget||"0","€"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Membres max:"}),e.jsxs(w,{variant:"secondary",children:[s.max_members," personnes"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Rôles définis:"}),e.jsxs(w,{variant:"secondary",children:[r.filter(t=>t.title).length," rôles"]})]})]})]}),e.jsx(j,{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-700",disabled:o,"data-testid":"button-submit-open-team",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Création en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Créer l'équipe ouverte"]})})]})}function We({mission:p,user:v,sortedBids:x,showAIAnalyzer:d,setShowAIAnalyzer:u,showBidForm:o,setShowBidForm:f}){const[s,i]=N.useState("individual"),[r,h]=N.useState(!1),[y,C]=N.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 md:p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:"Candidater à cette mission"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:"Choisissez votre mode de candidature"})]})]}),e.jsxs(ve,{value:s,onValueChange:S=>i(S),className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(ne,{value:"individual",className:"text-xs md:text-sm data-[testid=tab-individual]","data-testid":"tab-individual",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Solo"]}),e.jsxs(ne,{value:"team",className:"text-xs md:text-sm","data-testid":"tab-team",children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Équipe"]}),e.jsxs(ne,{value:"open_team",className:"text-xs md:text-sm","data-testid":"tab-open-team",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Équipe Ouverte"]})]}),e.jsx(F,{value:"individual",className:"space-y-4 mt-0",children:e.jsxs(M,{className:"bg-blue-50 border-blue-200",children:[e.jsx($,{className:"pb-3",children:e.jsxs(E,{className:"text-sm flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Candidature individuelle"]})}),e.jsxs(z,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez seul à cette mission avec votre expertise."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(j,{onClick:()=>u(!d),className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-sm",size:"default","data-testid":"button-ai-analyzer",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Analyser avec l'IA"]}),e.jsxs(j,{onClick:()=>f(!o),className:"w-full bg-green-600 hover:bg-green-700 text-sm",size:"default","data-testid":"button-submit-individual",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),o?"Masquer le formulaire":"Soumettre une offre"]})]}),d&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Be,{missionTitle:p.title,missionDescription:p.description,missionBudget:parseFloat(p.budget||"0"),missionCategory:p.category,currentBid:{price:0,timeline:"",proposal:""},providerProfile:{rating:4.5,completedProjects:25,skills:["React","Node.js","TypeScript"],portfolio:[]},competitorBids:x,onOptimizedBidGenerated:S=>{f(!0)}})}),o&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ge,{missionId:p.id,onSuccess:()=>{f(!1),u(!1)}})})]})]})}),e.jsx(F,{value:"team",className:"space-y-4 mt-0",children:e.jsxs(M,{className:"bg-purple-50 border-purple-200",children:[e.jsx($,{className:"pb-3",children:e.jsxs(E,{className:"text-sm flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Candidature d'équipe"]})}),e.jsxs(z,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Candidatez avec une équipe pré-constituée que vous dirigez."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-lg border",children:[e.jsx(re,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Vous êtes le chef d'équipe"})]}),e.jsxs(j,{onClick:()=>h(!r),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",size:"default","data-testid":"button-submit-team",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),r?"Masquer le formulaire":"Candidater en équipe"]})]}),r&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Xe,{missionId:p.id,onSuccess:()=>{h(!1)}})})]})]})}),e.jsx(F,{value:"open_team",className:"space-y-4 mt-0",children:e.jsxs(M,{className:"bg-orange-50 border-orange-200",children:[e.jsx($,{className:"pb-3",children:e.jsxs(E,{className:"text-sm flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Équipe ouverte"]})}),e.jsxs(z,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Créez une équipe ouverte où d'autres prestataires peuvent vous rejoindre."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(Ce,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Recrutement ouvert"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(He,{className:"w-3 h-3 text-orange-600"}),e.jsx("span",{children:"Collaboration"})]})]}),e.jsxs(j,{onClick:()=>C(!y),className:"w-full bg-orange-600 hover:bg-orange-700 text-sm",size:"default","data-testid":"button-submit-open-team",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),y?"Masquer le formulaire":"Créer une équipe ouverte"]})]}),y&&e.jsx("div",{className:"mt-4 p-4 bg-white rounded-lg border",children:e.jsx(Ze,{missionId:p.id,onSuccess:()=>{C(!1)}})})]})]})})]})]})}function Je({providerId:p,providerName:v,isOpen:x,onClose:d}){const{toast:u}=ae(),{data:o,isLoading:f}=be({queryKey:["/api/providers",p,"profile"],enabled:!!p&&x}),s=i=>Array.from({length:5},(r,h)=>e.jsx(re,{className:`w-4 h-4 ${h<i?"text-yellow-400 fill-current":"text-gray-300"}`},h));return!x||!p?null:e.jsx(B,{open:x,onOpenChange:d,children:e.jsxs(I,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(ue,{asChild:!0,children:e.jsx(Re,{children:"Profil du prestataire"})})}),e.jsx("div",{className:"p-6"}),f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):o?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:o.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),o.location||"Localisation non spécifiée"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Membre depuis ",X(o.joinedAt)]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:o.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center justify-end mb-2",children:[e.jsx("div",{className:"flex items-center mr-2",children:s(Math.round(parseFloat(o.rating)))}),e.jsx("span",{className:"text-xl font-bold",children:o.rating})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.totalProjects," projets réalisés"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.skills.map((i,r)=>e.jsx(w,{variant:"secondary",children:i},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs(j,{className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{window.location.href=`/messages?contact=${p}&name=${encodeURIComponent(v)}`},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(j,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",onClick:()=>{u({title:"Contacter le prestataire",description:`Appelez ${v} pour discuter du projet`})},children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Appeler"]}),e.jsxs(j,{className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white",onClick:()=>{u({title:"Réservation de créneau",description:`Fonctionnalité de réservation avec ${v} en cours de développement`})},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Réserver un créneau"]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(oe,{className:"w-5 h-5 mr-2"}),"Réalisations récentes"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:o.portfolio.slice(0,4).map(i=>e.jsx(M,{children:e.jsxs(z,{className:"p-4",children:[i.images.length>0&&e.jsx("img",{src:i.images[0],alt:i.title,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:i.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(w,{variant:"outline",children:i.category}),e.jsx("span",{className:"text-xs text-gray-500",children:X(i.completedAt)})]})]})},i.id))}),o.portfolio.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune réalisation disponible pour le moment"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2"}),"Disponibilités"]}),e.jsx(M,{children:e.jsx(z,{className:"p-4",children:e.jsx(Ie,{readOnly:!0,initialAvailability:o.availability||[]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Avis clients (",o.evaluations.length,")"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:o.evaluations.map(i=>e.jsx(M,{children:e.jsxs(z,{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[s(i.rating),e.jsx("span",{className:"ml-2 font-medium",children:i.clientName})]}),e.jsx("span",{className:"text-xs text-gray-500",children:X(i.createdAt)})]})}),e.jsx("p",{className:"text-gray-700 mb-3",children:i.comment}),i.photos&&i.photos.length>0&&e.jsx("div",{className:"flex space-x-2",children:i.photos.slice(0,3).map((r,h)=>e.jsx("img",{src:r,alt:`Photo ${h+1}`,className:"w-16 h-16 object-cover rounded-lg"},h))})]})},i.id))}),o.evaluations.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucun avis client pour le moment"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{onClick:d,children:"Fermer"})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Profil non trouvé"})})]})})}function Ye({bidId:p,bidderName:v,isOpen:x,onClose:d}){const{user:u}=U(),{toast:o}=ae(),f=ce(),[s,i]=N.useState(null),[r,h]=N.useState(""),y=De({mutationFn:async n=>(await me("POST","/api/bids/respond",n)).json(),onSuccess:()=>{f.invalidateQueries({queryKey:["/api/missions"]});const n=s==="accept"?"acceptée":s==="reject"?"déclinée":"en négociation";o({title:"Réponse envoyée !",description:`Votre réponse (${n}) a été envoyée au prestataire. Il recevra une notification.`}),setTimeout(()=>{alert(`Confirmation : Votre réponse "${n}" a bien été envoyée à ${v}. Un email de confirmation lui a été envoyé.`)},500),d(),i(null),h("")},onError:n=>{o({title:"Erreur",description:n.message||"Une erreur est survenue",variant:"destructive"})}}),C=n=>{if(n.preventDefault(),!s){o({title:"Action requise",description:"Veuillez choisir une action",variant:"destructive"});return}if(s==="negotiate"&&!r.trim()){o({title:"Message requis",description:"Veuillez ajouter un message pour négocier",variant:"destructive"});return}y.mutate({bidId:p,status:s,message:r.trim()||null,clientResponse:s})},S=n=>{switch(n){case"accept":return`Bonjour ${v},

Nous avons le plaisir de vous informer que votre offre a été retenue pour ce projet. Nous allons procéder à la mise en place du contrat.

Cordialement`;case"reject":return`Bonjour ${v},

Nous vous remercions pour votre offre. Malheureusement, nous avons décidé de retenir une autre proposition pour ce projet.

Cordialement`;case"negotiate":return`Bonjour ${v},

Votre offre nous intéresse. Cependant, nous aimerions discuter de certains points :

- 
- 

Êtes-vous ouvert à la négociation ?

Cordialement`}},T=n=>{i(n),h(S(n))};return e.jsx(B,{open:x,onOpenChange:d,children:e.jsxs(I,{className:"sm:max-w-2xl bg-white border shadow-lg",children:[e.jsx(xe,{children:e.jsxs(ue,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6 text-blue-500"}),"Répondre à l'offre de ",v]})}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choisissez votre réponse :"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>T("accept"),className:`p-4 rounded-xl border-2 transition-all ${s==="accept"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-green-300"}`,children:[e.jsx(Me,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("div",{className:"font-semibold",children:"Accepter"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Retenir cette offre"})]}),e.jsxs("button",{type:"button",onClick:()=>T("negotiate"),className:`p-4 rounded-xl border-2 transition-all ${s==="negotiate"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-blue-300"}`,children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"font-semibold",children:"Négocier"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Demander des ajustements"})]}),e.jsxs("button",{type:"button",onClick:()=>T("reject"),className:`p-4 rounded-xl border-2 transition-all ${s==="reject"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-red-300"}`,children:[e.jsx(Le,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),e.jsx("div",{className:"font-semibold",children:"Décliner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ne pas retenir"})]})]})]}),s&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"message",className:"text-sm font-semibold text-gray-800",children:["Message à ",v]}),e.jsx(V,{id:"message",value:r,onChange:n=>h(n.target.value),placeholder:"Votre message...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:d,className:"flex-1",disabled:y.isPending,children:"Annuler"}),e.jsx(j,{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600",disabled:!s||y.isPending,children:y.isPending?"Envoi...":"Envoyer la réponse"})]})]})]})})}function qs({missionId:p,isOpen:v,onClose:x}){const{user:d}=U(),[u,o]=N.useState("overview"),[f,s]=N.useState(null),[i,r]=N.useState(""),[h,y]=N.useState(null),[C,S]=N.useState(""),[T,n]=N.useState(!1),[g,t]=N.useState(!1),[a,m]=N.useState(!1),{data:c,isLoading:ie,error:le}=be({queryKey:["mission-detail",p],queryFn:async()=>{if(!p)throw new Error("ID de mission manquant");console.log("🔍 Chargement mission ID:",p);try{const l=await fetch(`/api/missions/${p}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok){const Q=await l.text();throw console.error("❌ Erreur API mission:",l.status,Q),new Error(`Erreur ${l.status}: ${l.statusText}`)}const q=await l.json();return console.log("✅ Mission chargée:",q?.title||"Sans titre"),q}catch(l){throw console.error("❌ Erreur réseau mission:",l),l}},enabled:!!p&&v,retry:1,retryDelay:2e3,staleTime:3e4}),ke=l=>{const q=typeof l=="string"?parseFloat(l):l;return Array.from({length:5},(Q,H)=>e.jsx(re,{className:`w-3 h-3 ${H<Math.floor(q)?"text-yellow-400 fill-current":"text-gray-300"}`},H))};if(ie)return e.jsx(B,{open:v,onOpenChange:x,children:e.jsx(I,{className:"w-[95vw] max-w-4xl mx-auto p-0 gap-0 bg-white dark:bg-gray-900 border-0 shadow-2xl rounded-xl overflow-hidden",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px] bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-3 border-blue-200 border-t-blue-600"}),e.jsx("div",{className:"absolute inset-0 animate-pulse rounded-full h-12 w-12 border-3 border-transparent border-t-purple-600 opacity-75"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base text-gray-700 dark:text-gray-300 font-semibold mb-1",children:"Chargement de la mission..."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Récupération des détails"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})})})});if(le||!c)return e.jsx(B,{open:v,onOpenChange:x,children:e.jsx(I,{className:"w-[95vw] max-w-lg mx-auto p-0 gap-0 bg-white dark:bg-gray-900 border-0 shadow-2xl rounded-xl overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 dark:from-gray-800 dark:to-red-900/20 p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/50 dark:to-red-800/50 rounded-full flex items-center justify-center shadow-lg animate-pulse",children:e.jsx(Oe,{className:"w-10 h-10 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"Mission introuvable"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-8 leading-relaxed",children:le instanceof Error?le.message:"Cette mission n'existe plus ou a été supprimée."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(j,{onClick:()=>window.location.reload(),variant:"outline",className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 transition-all duration-200",children:"Recharger la page"}),e.jsx(j,{onClick:x,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg transition-all duration-200 transform hover:scale-105",children:"Fermer"})]})]})})});const he=$e(c.category),R=c.bids?[...c.bids].sort((l,q)=>parseFloat(l.price||l.amount||"0")-parseFloat(q.price||q.amount||"0")):[],A=c.teamRequirements&&c.teamRequirements.length>0,K=l=>{m(!0),setTimeout(()=>{o(l),m(!1)},150)};return e.jsxs(B,{open:v,onOpenChange:x,children:[e.jsxs(I,{className:"w-[95vw] max-h-[90vh] max-w-4xl p-0 gap-0 bg-white dark:bg-gray-900 border-0 shadow-2xl rounded-xl overflow-hidden flex flex-col transition-all duration-300",children:[e.jsxs(xe,{className:"sr-only",children:[e.jsx(ue,{children:c.title}),e.jsx(ze,{children:"Détails de la mission"})]}),e.jsxs("div",{className:"flex flex-col min-h-0 max-h-[90vh]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-blue-700 to-purple-600 text-white relative flex-shrink-0 shadow-xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/20 via-purple-500/20 to-pink-500/20 animate-pulse"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-6",children:[e.jsx(j,{onClick:x,size:"sm",variant:"ghost",className:"text-white hover:bg-white/20 p-2 rounded-full md:hidden",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 md:flex-none min-w-0",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-bold leading-tight pr-2 md:pr-0 truncate",children:c.title}),e.jsxs("p",{className:"text-blue-100 text-sm md:text-base mt-1 opacity-90 truncate",children:["Par ",c.clientName," • ",G(c.budget||"0")]})]}),e.jsx(j,{onClick:x,size:"sm",variant:"ghost",className:"text-white hover:bg-white/20 p-1.5 rounded-full","aria-label":"Fermer la modal",children:e.jsx(se,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"px-3 pb-4 md:px-6 md:pb-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-6 text-sm text-blue-100 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ke,{className:"w-3 h-3"}),e.jsxs("span",{children:[R.length," candidature",R.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:X(c.createdAt||new Date().toISOString())}),e.jsx("span",{className:"sm:hidden",children:"Créé"})]}),he&&e.jsx(w,{className:"bg-white/25 text-white border-none text-sm px-3 py-1 rounded-full font-medium",children:he.name})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex-shrink-0 relative",children:[e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-600 to-purple-600 opacity-20"}),e.jsxs(ve,{value:u,onValueChange:K,className:"w-full",children:[e.jsxs(fe,{className:"w-full h-14 md:h-16 bg-transparent rounded-none border-none p-0 relative",children:[e.jsx("div",{className:`absolute bottom-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600 transition-all duration-300 ease-out rounded-t-full shadow-lg ${u==="overview"?"left-0 w-1/3":u==="bids"?`left-1/3 w-1/3 ${A?"":"left-1/2 w-1/2"}`:u==="team"?"left-2/3 w-1/3":""}`,style:{width:A?"33.333333%":"50%",left:u==="overview"?"0%":u==="bids"?A?"33.333333%":"50%":u==="team"?"66.666667%":"0%"}}),e.jsxs("div",{className:"flex w-full relative z-10",children:[e.jsxs("button",{onClick:()=>K("overview"),className:`flex-1 h-14 md:h-16 text-sm font-semibold px-3 transition-all duration-300 ease-out flex items-center justify-center gap-2 ${u==="overview"?"text-blue-600 dark:text-blue-400 transform scale-105":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(oe,{className:`w-4 h-4 transition-all duration-300 ${u==="overview"?"text-blue-600 dark:text-blue-400 animate-pulse":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Aperçu"}),e.jsx("span",{className:"sm:hidden",children:"Info"})]}),e.jsxs("button",{onClick:()=>K("bids"),className:`flex-1 h-14 md:h-16 text-sm font-semibold px-3 transition-all duration-300 ease-out flex items-center justify-center gap-2 ${u==="bids"?"text-blue-600 dark:text-blue-400 transform scale-105":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(D,{className:`w-4 h-4 transition-all duration-300 ${u==="bids"?"text-blue-600 dark:text-blue-400 animate-pulse":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Offres"}),e.jsx("span",{className:"sm:hidden flex items-center gap-1",children:e.jsx("span",{className:`inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold rounded-full transition-all duration-300 ${u==="bids"?"bg-blue-600 text-white scale-110":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:R.length})}),e.jsx("span",{className:"hidden sm:inline",children:e.jsx("span",{className:`inline-flex items-center justify-center min-w-[24px] h-6 px-2 text-xs font-bold rounded-full transition-all duration-300 ml-1 ${u==="bids"?"bg-blue-600 text-white scale-110":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:R.length})})]}),A&&e.jsxs("button",{onClick:()=>K("team"),className:`flex-1 h-14 md:h-16 text-sm font-semibold px-3 transition-all duration-300 ease-out flex items-center justify-center gap-2 ${u==="team"?"text-blue-600 dark:text-blue-400 transform scale-105":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx(ge,{className:`w-4 h-4 transition-all duration-300 ${u==="team"?"text-blue-600 dark:text-blue-400 animate-pulse":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Équipe"}),e.jsx("span",{className:"sm:hidden",children:"Team"})]})]})]}),e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx(F,{value:"overview",className:`m-0 absolute inset-0 transition-all duration-300 ease-out ${u==="overview"?"opacity-100 translate-x-0 pointer-events-auto":"opacity-0 translate-x-4 pointer-events-none"} data-[state=active]:flex data-[state=active]:flex-col`,children:e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent",children:e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6 pb-6 md:pb-8 bg-gray-50 dark:bg-gray-900/50 min-h-full",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 shadow-sm border",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3 text-sm md:text-base",children:"Description du projet"}),e.jsx("p",{className:"text-gray-700 leading-relaxed text-sm md:text-base",children:c.description})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 md:p-4 border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 md:mb-2",children:[e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900 text-xs md:text-sm",children:"Budget"})]}),e.jsx("div",{className:"text-lg md:text-2xl font-bold text-green-600",children:G(c.budget||"0")})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 md:p-4 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 md:mb-2",children:[e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ye,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900 text-xs md:text-sm",children:"Lieu"})]}),e.jsx("div",{className:"text-blue-600 font-medium text-xs md:text-base truncate",children:c.location||"Non spécifié"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 md:p-4 border border-purple-100 col-span-2 md:col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 md:mb-2",children:[e.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(Qe,{className:"w-3 h-3 md:w-4 md:h-4 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900 text-xs md:text-sm",children:"Intérêt"})]}),e.jsxs("div",{className:"text-purple-600 font-medium text-xs md:text-base",children:[R.length," candidature",R.length!==1?"s":""]})]})]}),d&&d.type==="provider"&&c.clientName!==d.name&&e.jsx(We,{mission:c,user:d,sortedBids:R,showAIAnalyzer:g,setShowAIAnalyzer:t,showBidForm:T,setShowBidForm:n}),d&&d.type==="provider"&&c.clientName===d.name&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-blue-700 font-medium text-sm",children:"Ceci est votre mission"})]})})]})})}),e.jsx(F,{value:"bids",className:`m-0 absolute inset-0 transition-all duration-300 ease-out ${u==="bids"?"opacity-100 translate-x-0 pointer-events-auto":"opacity-0 translate-x-4 pointer-events-none"} data-[state=active]:flex data-[state=active]:flex-col`,children:e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent",children:e.jsx("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6 pb-6 md:pb-8 bg-gray-50 dark:bg-gray-900/50 min-h-full",children:R.length===0?e.jsxs("div",{className:"bg-white rounded-lg p-8 md:p-12 text-center shadow-sm border",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune candidature"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Les prestataires peuvent encore postuler"})]}):e.jsx("div",{className:"space-y-3",children:R.map((l,q)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 shadow-sm border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l.providerName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-semibold text-gray-900 cursor-pointer hover:text-blue-600 transition-colors text-sm md:text-base",onClick:()=>{s(l.providerId),r(l.providerName)},children:l.providerName}),l.bid_type==="team"&&e.jsxs(w,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 border-purple-200",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Équipe"]}),l.bid_type==="open_team"&&e.jsxs(w,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-green-100 text-green-700 border-green-200",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Équipe Ouverte"]}),(!l.bid_type||l.bid_type==="individual")&&e.jsxs(w,{variant:"secondary",className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 border-blue-200",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Individuel"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center",children:ke(l.rating||"5.0")}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:[parseFloat(l.rating||"5.0").toFixed(1),"/5"]}),q===0&&R.length>1&&e.jsx(w,{className:"bg-green-100 text-green-700 text-xs ml-2",children:"Meilleure offre"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg md:text-xl font-bold text-green-600",children:G(l.price)}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center justify-end mt-1",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),l.timeline]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 md:p-4 mb-4 border-l-4 border-blue-400",children:e.jsx("p",{className:"text-gray-700 text-sm md:text-base leading-relaxed whitespace-pre-line",children:l.proposal})}),d&&(c.clientName===d.name||c.userName===d.name)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs(j,{onClick:()=>{y(l.id),S(l.providerName)},variant:"outline",size:"sm",className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(O,{className:"w-4 h-4"}),"Répondre"]}),e.jsxs(j,{size:"sm",className:"bg-green-500 hover:bg-green-600 text-white flex items-center justify-center gap-2 text-sm",children:[e.jsx(je,{className:"w-4 h-4"}),"Accepter"]})]})]},l.id))})})})}),A&&e.jsx(F,{value:"team",className:`m-0 absolute inset-0 transition-all duration-300 ease-out ${u==="team"?"opacity-100 translate-x-0 pointer-events-auto":"opacity-0 translate-x-4 pointer-events-none"} data-[state=active]:flex data-[state=active]:flex-col`,children:e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent",children:e.jsx("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6 pb-6 md:pb-8 bg-gray-50 dark:bg-gray-900/50 min-h-full",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 shadow-sm border",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2 text-sm md:text-base",children:[e.jsx(ge,{className:"w-5 h-5"}),"Composition de l'équipe"]}),e.jsx("div",{className:"space-y-3",children:c.teamRequirements?.map((l,q)=>e.jsxs("div",{className:"border-l-4 border-l-blue-500 bg-blue-50/50 rounded-r-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm md:text-base",children:l.role}),e.jsx("p",{className:"text-gray-600 text-xs md:text-sm",children:l.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm md:text-base font-bold text-green-600",children:G(l.budget||"0")}),e.jsxs(w,{variant:"outline",className:"text-xs",children:[l.quantity," personne",l.quantity>1?"s":""]})]})]}),l.skills&&l.skills.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-xs mb-2",children:"Compétences :"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.skills.map((Q,H)=>e.jsx(w,{variant:"secondary",className:"text-xs",children:Q},H))})]})]},q))})]})})})})]})]})]})]})]}),e.jsx(Je,{providerId:f,providerName:i,isOpen:!!f,onClose:()=>{s(null),r("")}}),e.jsx(Ye,{bidId:h,bidderName:C,isOpen:!!h,onClose:()=>{y(null),S("")}})]})}export{qs as M};
