import{j as e,r as v}from"./ui-BcXBiFQq.js";import{u as A}from"./useQuery-DmC_wvbD.js";import{B as S}from"./badge-Bi8GnAfP.js";import{C as F,a as R,b as E,U as O,c as X,d as B,L as y,I as z,B as T}from"./index-Vx-2FErA.js";import{c as L}from"./categories-Ci5EyH-Y.js";import{E as P}from"./euro-ZQP_Dg4e.js";import{M as V}from"./map-pin-DS0DRPwE.js";import{T as _}from"./trending-up-CNUwBImZ.js";import{C as H}from"./clock-B_xxW67l.js";import{t as d,c as U,e as Y,d as W,g as I,a as q,b as K,m as k,f as b}from"./calendar-CuXdbPNQ.js";import{f as Q}from"./availability-calendar-BQIINeEg.js";import{M as G}from"./mission-detail-modal-BMhdTQBC.js";import{S as w,a as M,b as D,c as C,d as h}from"./select-61nujBW8.js";import{M as J}from"./mission-matching-engine-CsorTkM1.js";import"./vendor-D3F3s8fL.js";import"./chevron-left-B_8H3kEX.js";import"./trash-2-DnVVf3ET.js";import"./save-BK2muszO.js";import"./textarea-B4KYmpFA.js";import"./tabs-CkENf0iN.js";import"./calendar-CjeECyQT.js";import"./message-circle-BYVK-WSS.js";import"./phone-Dv_q3qli.js";import"./award-CThI7Orw.js";import"./star-BXLXbnLX.js";import"./circle-x-DyjwjEtM.js";import"./smart-bid-analyzer-BY1wEYL2.js";import"./triangle-alert-CvJDoMDn.js";import"./lightbulb-DI7P91_3.js";import"./circle-alert-BQkU51fi.js";import"./eye-_OtSagOv.js";import"./index-DIYLGAU4.js";function j(t,a){const n=d(t),c=d(a),r=n.getTime()-c.getTime();return r<0?-1:r>0?1:r}function Z(t){return U(t,Date.now())}function $(t){return a=>{const c=(t?Math[t]:Math.trunc)(a);return c===0?0:c}}function ee(t,a){return+d(t)-+d(a)}function se(t){const a=d(t);return a.setHours(23,59,59,999),a}function te(t){const a=d(t);return+se(a)==+Y(a)}function re(t,a){const n=d(t),c=d(a),r=j(n,c),o=Math.abs(W(n,c));let m;if(o<1)m=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-r*o);let l=j(n,c)===-r;te(d(t))&&o===1&&j(t,c)===1&&(l=!1),m=r*(o-Number(l))}return m===0?0:m}function ae(t,a,n){const c=ee(t,a)/1e3;return $(n?.roundingMethod)(c)}function le(t,a,n){const c=q(),r=n?.locale??c.locale??K,o=2520,m=j(t,a);if(isNaN(m))throw new RangeError("Invalid time value");const l=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:m});let g,u;m>0?(g=d(a),u=d(t)):(g=d(t),u=d(a));const x=ae(u,g),p=(I(u)-I(g))/1e3,s=Math.round((x-p)/60);let i;if(s<2)return n?.includeSeconds?x<5?r.formatDistance("lessThanXSeconds",5,l):x<10?r.formatDistance("lessThanXSeconds",10,l):x<20?r.formatDistance("lessThanXSeconds",20,l):x<40?r.formatDistance("halfAMinute",0,l):x<60?r.formatDistance("lessThanXMinutes",1,l):r.formatDistance("xMinutes",1,l):s===0?r.formatDistance("lessThanXMinutes",1,l):r.formatDistance("xMinutes",s,l);if(s<45)return r.formatDistance("xMinutes",s,l);if(s<90)return r.formatDistance("aboutXHours",1,l);if(s<k){const f=Math.round(s/60);return r.formatDistance("aboutXHours",f,l)}else{if(s<o)return r.formatDistance("xDays",1,l);if(s<b){const f=Math.round(s/k);return r.formatDistance("xDays",f,l)}else if(s<b*2)return i=Math.round(s/b),r.formatDistance("aboutXMonths",i,l)}if(i=re(u,g),i<12){const f=Math.round(s/b);return r.formatDistance("xMonths",f,l)}else{const f=i%12,N=Math.trunc(i/12);return f<3?r.formatDistance("aboutXYears",N,l):f<9?r.formatDistance("overXYears",N,l):r.formatDistance("almostXYears",N+1,l)}}function ne(t,a){return le(t,Z(t),a)}function oe({mission:t,onClick:a}){const n=L.find(r=>r.id===t.category),c=t.bids.length>0?t.bids.reduce((r,o)=>r+parseFloat(o.price),0)/t.bids.length:0;return e.jsxs(F,{className:"hover:shadow-lg transition-all duration-300 cursor-pointer border-l-4 border-l-blue-500 hover:scale-[1.02] bg-white h-fit",onClick:a,children:[e.jsx(R,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h3",{className:"font-semibold text-base line-clamp-2 flex-1 leading-tight",children:t.title}),e.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[e.jsx(S,{variant:"secondary",className:"shrink-0 text-xs px-2 py-1",children:n?.name||t.category}),t.bids.length>0&&e.jsxs(S,{variant:"outline",className:"text-xs px-2 py-1",children:["🔥 ",t.bids.length]})]})]})}),e.jsxs(E,{className:"py-1",children:[e.jsx("p",{className:"text-gray-600 line-clamp-2 mb-3 text-sm leading-relaxed",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(P,{className:"w-3 h-3 text-green-600"}),e.jsxs("span",{className:"font-medium truncate",children:[typeof t.budget=="number"?t.budget:parseInt(t.budget||"0"),"€"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(O,{className:"w-3 h-3 text-purple-600"}),e.jsxs("span",{className:"truncate",children:[t.bids.length," offre",t.bids.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(V,{className:"w-3 h-3 text-blue-600"}),e.jsx("span",{className:"truncate",children:t.location||"Non spécifié"})]}),c>0&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(_,{className:"w-3 h-3 text-orange-600"}),e.jsxs("span",{className:"font-medium truncate",children:[Math.round(c),"€ moy"]})]})]})]}),e.jsx(X,{className:"pt-2 pb-3 border-t bg-gray-50/50",children:e.jsxs("div",{className:"flex justify-between items-center w-full text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:ne(new Date(t.createdAt),{addSuffix:!0,locale:Q})})]}),e.jsx("div",{className:"text-xs font-medium text-primary truncate ml-2",children:t.clientName})]})})]})}function Pe(){const{user:t}=B(),[a,n]=v.useState(null),[c,r]=v.useState(!1),[o,m]=v.useState({category:"all",budget:"all",location:"",sort:"newest"}),{data:l=[],isLoading:g,error:u}=A({queryKey:["/api/missions"],refetchInterval:6e4,retry:2,retryDelay:s=>Math.min(1e3*2**s,5e3),staleTime:3e4,gcTime:3e5,refetchOnWindowFocus:!1,onError:s=>{console.error("❌ Erreur chargement missions:",s)},onSuccess:s=>{console.log("✅ Missions chargées avec succès:",s?.length||0)}});console.log("🏪 Marketplace - État actuel:",{missionsCount:l.length,isLoading:g,hasError:!!u,errorMessage:u?.message});const x=l.filter(s=>{if(o.category&&o.category!=="all"&&s.category!==o.category||o.location&&!s.location?.toLowerCase().includes(o.location.toLowerCase()))return!1;if(o.budget&&o.budget!=="all"){const i=parseFloat(s.budget||"0");switch(o.budget){case"0-500":return i>=0&&i<=500;case"500-2000":return i>500&&i<=2e3;case"2000-5000":return i>2e3&&i<=5e3;case"5000+":return i>5e3;default:return!0}}return!0}).sort((s,i)=>{switch(o.sort){case"newest":return new Date(i.createdAt).getTime()-new Date(s.createdAt).getTime();case"budget-high":return parseFloat(i.budget||"0")-parseFloat(s.budget||"0");case"budget-low":return parseFloat(s.budget||"0")-parseFloat(i.budget||"0");case"bids":return i.bids.length-s.bids.length;default:return 0}}),p=(s,i)=>{m(f=>({...f,[s]:i}))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-2 sm:mb-4",children:"Marketplace des Projets"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600",children:"Découvrez et soumissionnez sur les projets disponibles"})]}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50/30 to-purple-50/20 rounded-3xl shadow-xl border border-blue-100/50 p-6 sm:p-8 sticky top-24 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Filtrer les projets"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Catégorie"]}),e.jsxs(w,{value:o.category,onValueChange:s=>p("category",s),children:[e.jsx(M,{className:"bg-white/80 border-gray-200 hover:border-blue-400 transition-colors",children:e.jsx(D,{placeholder:"Toutes les catégories"})}),e.jsxs(C,{children:[e.jsx(h,{value:"all",children:"Toutes les catégories"}),L.map(s=>e.jsx(h,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Budget"]}),e.jsxs(w,{value:o.budget,onValueChange:s=>p("budget",s),children:[e.jsx(M,{className:"bg-white/80 border-gray-200 hover:border-green-400 transition-colors",children:e.jsx(D,{placeholder:"Tous les budgets"})}),e.jsxs(C,{children:[e.jsx(h,{value:"all",children:"Tous les budgets"}),e.jsx(h,{value:"0-500",children:"0 - 500€"}),e.jsx(h,{value:"500-2000",children:"500 - 2 000€"}),e.jsx(h,{value:"2000-5000",children:"2 000 - 5 000€"}),e.jsx(h,{value:"5000+",children:"5 000€+"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Localisation"]}),e.jsx(z,{type:"text",placeholder:"Ville, région...",value:o.location,onChange:s=>p("location",s.target.value),className:"bg-white/80 border-gray-200 hover:border-purple-400 focus:border-purple-500 transition-colors"})]})]}),e.jsx(T,{onClick:()=>m({category:"all",budget:"all",location:"",sort:"newest"}),variant:"outline",className:"w-full border-gray-300 hover:bg-gray-50 transition-all duration-200 hover:shadow-md",children:"🔄 Réinitialiser les filtres"})]})}),e.jsxs("div",{className:"lg:w-3/4 w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-4 sm:mb-0",children:["Toutes les missions (",x.length,")"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto",children:[t?.type==="provider"&&e.jsx(T,{onClick:()=>r(!c),className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 w-full sm:w-auto",children:"🤖 Matching IA"}),e.jsxs("div",{className:"flex items-center space-x-2 w-full sm:w-auto",children:[e.jsx("span",{className:"text-sm text-gray-500 whitespace-nowrap",children:"Trier par:"}),e.jsxs(w,{value:o.sort,onValueChange:s=>p("sort",s),children:[e.jsx(M,{className:"w-full sm:w-40",children:e.jsx(D,{})}),e.jsxs(C,{children:[e.jsx(h,{value:"newest",children:"Plus récent"}),e.jsx(h,{value:"budget-high",children:"Budget décroissant"}),e.jsx(h,{value:"budget-low",children:"Budget croissant"}),e.jsx(h,{value:"bids",children:"Nombre d'offres"})]})]})]})]})]}),c&&t?.type==="provider"&&e.jsx("div",{className:"mb-8",children:e.jsx(J,{providerProfile:{id:t.id,skills:["React","Node.js","TypeScript","Python"],location:"Paris",rating:4.7,completedProjects:28,portfolio:[],hourlyRate:65,categories:["web-development","mobile-development"]},missions:x,onMissionRecommended:s=>{n(s.missionId),r(!1)}})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[g&&e.jsxs("div",{className:"text-center py-12 sm:col-span-2 lg:col-span-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Chargement des missions..."})]}),u&&e.jsxs("div",{className:"text-center py-12 sm:col-span-2 lg:col-span-3",children:[e.jsx("div",{className:"text-red-500 mb-4",children:"❌"}),e.jsx("p",{className:"text-red-500 text-lg",children:"Erreur de chargement"}),e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["Impossible de charger les missions.",!1]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Recharger la page"})]}),!g&&!u&&x.map(s=>e.jsx(oe,{mission:s,onClick:()=>n(s.id)},s.id)),!g&&!u&&x.length===0&&e.jsxs("div",{className:"text-center py-12 sm:col-span-2 lg:col-span-3",children:[e.jsx("div",{className:"text-gray-300 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L10 8.586 8.707 7.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("p",{className:"text-gray-500 text-lg",children:["Aucune mission trouvée (",l.length," missions totales)"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Essayez de modifier vos filtres"})]})]})]}),e.jsx(G,{missionId:a,isOpen:!!a,onClose:()=>n(null)})]})}export{Pe as default};
